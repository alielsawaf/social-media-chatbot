import os
import requests
from flask import Flask, request

app = Flask(__name__)

# ================== CONFIG (ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¶Ø¹ Ù‡Ø°Ù‡ Ø§Ù„Ù‚ÙŠÙ… ÙÙŠ Ø±ÙŠÙ„ÙˆØ§ÙŠ) ==================
PAGE_ACCESS_TOKEN = os.environ.get("PAGE_ACCESS_TOKEN")
VERIFY_TOKEN = os.environ.get("VERIFY_TOKEN")
GROQ_API_KEY = os.environ.get("GROQ_API_KEY")

# ================== DATA (Ø­Ø§ÙØ¸Ù†Ø§ Ø¹Ù„Ù‰ ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ) ==================
FAQ_MAP = {
    "Ø§Ù„Ø±Ù†Ø¬Ø© ÙÙŠÙ‡Ø§ Ø¯ÙˆØ¯": "ÙÙ†Ø¯Ù… Ø¯Ù‡ Ù…Ø´ Ø¯ÙˆØ¯ØŒ Ø¯Ù‡ Ø¨ÙŠÙƒÙˆÙ† Ø·ÙÙŠÙ„ÙŠØ§Øª... (Ù†ÙØ³ Ø§Ù„Ù†Øµ Ø§Ù„Ù„ÙŠ Ø¹Ù†Ø¯Ùƒ)",
    "Ù…Ù†ÙŠÙˆ": "Ø¯Ù‡ Ù„ÙŠÙ†Ùƒ Ù…Ù†ÙŠÙˆ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨ØªØ§Ø¹ØªÙ†Ø§: https://heyzine.com/flip-book/31946f16d5.html",
    "Ø§Ø²Ø§ÙŠ Ø§ØªØ£ÙƒØ¯ Ø§Ù† Ø§Ù„Ø±Ù†Ø¬Ø© Ø¯ÙŠ Ø±Ù†Ø¬Ø© Ø§Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯": "Ø­Ø¶Ø±ØªÙƒ Ø­Ø§ÙˆÙ„ Ø´Ø±Ø§Ø¡ Ø±Ù†Ø¬Ø© Ø£Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ÙˆØ«ÙˆÙ‚Ø© Ù„Ø¶Ù…Ø§Ù† Ø­ØµÙˆÙ„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ØµÙ„ÙŠ.",
    "Ø§Ù„Ø¬Ù…Ù„Ø© Ø§Ùˆ Ø§Ø³Ø¹Ø§Ø± Ø§Ù„Ø¬Ù…Ù„Ø©": "Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± ÙˆØ·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ØµÙ†Ø¹: 01211113882",
    "Ø§Ù„Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª": "Ù…Ù†ÙŠÙˆ Ø§Ù„Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´Ø§Øª ÙˆØ§Ù„Ø³Ù„Ø·Ø© ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹ ÙˆÙ„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆØµÙŠÙ„ Ù„Ù„Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´Ø§Øª ÙˆØ§Ù„Ø³Ù„Ø·Ø©.",
    "Ø§Ù„Ø³Ù„Ø·Ø©": "Ù…Ù†ÙŠÙˆ Ø§Ù„Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´Ø§Øª ÙˆØ§Ù„Ø³Ù„Ø·Ø© ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹ ÙˆÙ„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆØµÙŠÙ„ Ù„Ù„Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´Ø§Øª ÙˆØ§Ù„Ø³Ù„Ø·Ø©.",
    "Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙØ±ÙˆØ¹": "Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ Ù…Ù† Ø§Ù„Ø³Ø§Ø¹Ø© 10 ØµØ¨Ø§Ø­Ø§Ù‹ Ø­ØªÙ‰ Ø§Ù„Ø³Ø§Ø¹Ø© 12 Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„.",
    "Ø§Ù„ØªØµØ¯ÙŠØ±": "Ø­Ø¶Ø±ØªÙƒ ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨ Ù…Ø¹ Ø§Ù„Ø£Ø³ØªØ§Ø° Ø£Ø­Ù…Ø¯ Ø¹Ù„Ù‰ Ø±Ù‚Ù… 01272475555 ÙˆÙ‡Ùˆ Ù‡ÙŠØ³Ø§Ø¹Ø¯ Ø­Ø¶Ø±ØªÙƒ.",
    "Ø±Ù‚Ù… Ø§Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª": "Ø±Ù‚Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª: 01223066445",
    "Ø§Ù„ØªÙˆØ¸ÙŠÙ": "Ø±Ù‚Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù€ HR ÙÙŠ Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯: 01200056103",
    "Ù…Ù…ÙƒÙ† Ø§Ø´ÙˆÙŠ Ø§Ù„Ø±Ù†Ø¬Ø©": "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù†Ø¬Ø© Ù„Ù„Ø´ÙˆÙŠ ÙˆÙ„Ø§ ØªØªØ¹Ø±Ø¶ Ù„Ø£ÙŠ Ø­Ø±Ø§Ø±Ø©ØŒ Ø±Ù†Ø¬Ø© Ø£Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø£ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø¯Ù‡Ù†Ù‡Ø§ Ø¨Ø§Ù„Ø²ÙŠØª.",
    "Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ù…Ø¬Ù…Ø¯Ø© ÙˆØ§Ù„ÙØ±ÙŠØ´": "Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ù…Ø¬Ù…Ø¯Ø© ØªØ­ÙØ¸ ÙÙŠ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© -18 ÙˆØµÙ„Ø§Ø­ÙŠØªÙ‡Ø§ 3 Ø´Ù‡ÙˆØ± ÙˆÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„ØªØ¬Ù…ÙŠØ¯. Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„ÙØ±ÙŠØ´ ØªØ­ÙØ¸ ÙÙŠ Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø© Ù…Ù† 0 Ø¥Ù„Ù‰ 4 ÙˆØµÙ„Ø§Ø­ÙŠØªÙ‡Ø§ Ø´Ù‡Ø± ÙˆÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„ØªØ¨Ø±ÙŠØ¯.",
    "ÙˆØ²Ù† ÙƒØ±ØªÙˆÙ†Ø© Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ù…Ø¬Ù…Ø¯Ø©": "ÙˆØ²Ù† ÙƒØ±ØªÙˆÙ†Ø© Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ù…Ø¬Ù…Ø¯Ø© Ø¨ÙŠÙƒÙˆÙ† Ù…Ù† 7.5 Ø¥Ù„Ù‰ 8 ÙƒÙŠÙ„Ùˆ ÙŠØ§ ÙÙ†Ø¯Ù….",
    "Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„ÙƒÙŠØ³ Ø§Ù„Ø§Ø³ÙˆØ¯ ÙˆØ§Ù„Ø¬ÙˆÙ„Ø¯ ÙØ§ÙƒÙŠÙˆÙ… ÙÙŠ Ø§Ù„ÙØ³ÙŠØ®": "Ø§Ù„Ø£Ø­Ø¬Ø§Ù… Ø§Ù„ØµØºÙŠØ±Ø© Ø¨ØªÙƒÙˆÙ† ÙÙŠ Ø§Ù„ØªØºÙ„ÙŠÙ Ø§Ù„Ø¬ÙˆÙ„Ø¯ ÙØ§ÙƒÙŠÙˆÙ… Ø¨Ø­Ø¯ Ø£Ù‚ØµÙ‰ 600 Ø¬Ø±Ø§Ù…ØŒ ÙˆØ§Ù„Ø£Ø­Ø¬Ø§Ù… Ø§Ù„Ø£ÙƒØ¨Ø± Ø¨ØªÙƒÙˆÙ† ÙÙŠ Ø§Ù„ØªØºÙ„ÙŠÙ Ø§Ù„Ø£Ø³ÙˆØ¯ ÙˆÙ…Ù…ÙƒÙ† ØªÙˆØµÙ„ Ù„ÙƒÙŠÙ„Ùˆ Ø£Ùˆ ÙƒÙŠÙ„Ùˆ Ùˆ200 Ø£Ùˆ 800 Ø¬Ø±Ø§Ù….",
    "Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆØ¹ÙŠØ§Ø± 24": "Ø¹ÙŠØ§Ø± 24 Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ¯Ø®ÙŠÙ† ÙÙŠÙ‡ Ø£Ø·ÙˆÙ„ØŒ Ø­Ø¬Ù… Ø§Ù„Ø³Ù…ÙƒØ© Ø£ØµØºØ±ØŒ ÙˆØ·Ø¹Ù… Ø§Ù„ØªØ¯Ø®ÙŠÙ† Ù…Ø¹Ø²Ø² Ø£ÙƒØ«Ø± Ø¨Ø³Ø¨Ø¨ Ø²ÙŠØ§Ø¯Ø© Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ¯Ø®ÙŠÙ†.",
    "ÙƒÙŠÙÙŠØ© Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø±Ù†Ø¬Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡": "ÙŠÙØ¶Ù„ Ø­ÙØ¸ Ø§Ù„Ø±Ù†Ø¬Ø© ÙÙŠ Ø§Ù„ÙØ±ÙŠØ²Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡.",
    "ÙŠØ¹Ù†ÙŠ Ø§ÙŠÙ‡ Ø±Ù†Ø¬Ø© ÙØ§ÙƒÙŠÙˆÙ…": "Ø±Ù†Ø¬Ø© Ù…ØºÙ„ÙØ© ÙÙŠ Ø¹Ø¨ÙˆØ§Øª Ù…ÙØ±ØºØ© Ø§Ù„Ù‡ÙˆØ§Ø¡.",
    "Ø§Ù„ÙØ³ÙŠØ® Ø¨ÙŠØªÙ…Ù„Ø­ Ø§Ø²Ø§ÙŠ": "Ø§Ù„ÙØ³ÙŠØ® ÙŠØªÙ… ØªØµÙ†ÙŠØ¹Ù‡ Ù…Ù† Ø³Ù…Ùƒ Ø§Ù„Ø¨ÙˆØ±ÙŠØŒ ÙŠØªÙ… ØªÙ…Ù„ÙŠØ­Ù‡ ÙØ±ÙŠØ´ Ù„ÙˆÙ‚Ù Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„Ø¨ÙƒØªÙŠØ±ÙŠØŒ ØªÙ…Ù„ÙŠØ­ Ø¬Ø§ÙØŒ ÙˆÙŠØ­ÙØ¸ ÙÙŠ Ø«Ù„Ø§Ø¬Ø§Øª Ø¨Ø¯Ø±Ø¬Ø§Øª Ø­Ø±Ø§Ø±Ø© Ù…Ù† 0 Ø¥Ù„Ù‰ 4.",
    "Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ù„Ø­Ù… Ø§Ù„ØªÙˆÙ†Ø© Ø§Ù„Ø§Ø¨ÙŠØ¶ ÙˆØ§Ù„Ø§Ø­Ù…Ø±": "Ø§Ù„Ù„Ø­Ù… Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø£ÙØªØ­ Ù…Ù† Ø§Ù„Ø£Ø­Ù…Ø± Ù„Ø£Ù† Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± Ù†Ø§ØªØ¬ Ø¹Ù† Ø§Ù„Ù…ÙŠÙˆØ¬Ù„ÙˆØ¨ÙŠÙ† ÙˆØ§Ù„Ù‡ÙŠÙ…ÙˆØ¬Ù„ÙˆØ¨ÙŠÙ†ØŒ ÙˆØ§Ù„Ù„Ø­Ù… Ø§Ù„Ø£Ø­Ù…Ø± ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†Ø³Ø¨Ø© Ø¨Ø±ÙˆØªÙŠÙ† Ø£Ø¹Ù„Ù‰ ÙˆÙŠÙƒÙˆÙ† Ø·Ø±ÙŠ Ø£ÙƒØ«Ø±.",
    "Ù„ÙŠÙ‡ Ø§Ù„ÙØ³ÙŠØ® Ø¨ÙŠÙƒÙˆÙ† ÙÙŠ Ø¯Ù…": "Ø§Ù„Ø³Ù…ÙƒØ© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø£ÙƒÙ„ØŒ ÙˆØ§Ù„Ø¯Ù… Ø¨ÙŠÙƒÙˆÙ† Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªÙ…Ù„ÙŠØ­ Ø§Ù„ÙØ±ÙŠØ´ ÙˆØ§Ù„ØªØ¬Ù…ÙŠØ¯ØŒ ÙˆØ¹Ù†Ø¯ ÙÙƒ Ø§Ù„ØªØ¬Ù…ÙŠØ¯ Ø¨ØªØ¸Ù‡Ø± Ø§Ù„Ø³ÙˆØ§Ø¦Ù„.",
    "Ù„ÙŠÙ‡ Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„ÙÙŠÙ„ÙŠÙ‡ Ù†Ø§Ø´ÙØ©": "Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„ÙÙŠÙ„ÙŠÙ‡ Ø¨ØªÙƒÙˆÙ† Ù…Ø®Ù„ÙŠØ© ÙˆØ¨ØªØ§Ø®Ø¯ 3 Ø·Ø¨Ù‚Ø§Øª ØªØ¯Ø®ÙŠÙ† Ù„ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø·Ø¹Ù… ÙˆØ¯Ù‡ Ø¨ÙŠØ®Ù„ÙŠÙ‡Ø§ Ø£Ù†Ø´Ù Ø´ÙˆÙŠØ©.",
    "Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„ÙÙŠÙ„ÙŠÙ‡ ÙˆØ§Ù„Ø¹Ø§Ø¯ÙŠØ©": "Ø§Ù„ÙÙŠÙ„ÙŠÙ‡ Ù…Ø®Ù„ÙŠØ© ÙˆØªÙ…Ø± Ø¨Ù…Ø±Ø§Ø­Ù„ ØªÙ…Ù„ÙŠØ­ ÙˆØªØ¯Ø®ÙŠÙ† Ù…ÙƒØ«Ù Ùˆ3 Ø·Ø¨Ù‚Ø§Øª Ø³Ù…ÙˆÙƒØŒ ÙˆØ¨ØªÙƒÙˆÙ† Ø£Ù†Ø´Ù ÙˆØ·Ø¹Ù…Ù‡Ø§ Ù…Ø®ØªÙ„Ù.",
    "Ù…Ø¯ÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª": "Ø§Ù„Ø£Ø³ØªØ§Ø° Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù…Ø§Ø¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§ØªØŒ Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„: 01204464066",
    "ØªÙˆØ±ÙŠØ¯ Ù„Ù„ÙÙ†Ø§Ø¯Ù‚ ÙˆØ§Ù„Ù…Ø·Ø§Ø¹Ù…": "Ø§Ù„Ø£Ø³ØªØ§Ø° Ø¨Ù„Ø§Ù„ Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ØªÙˆØ±ÙŠØ¯ØŒ Ø±Ù‚Ù… Ø§Ù„ØªÙˆØ§ØµÙ„: 01221093951",
    "Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø³Ù„Ù…ÙˆÙ† Ø§Ù„ÙØ§ÙƒÙŠÙˆÙ… ÙˆØ§Ù„ÙƒÙŠØ³ Ø§Ù„Ø§Ø³ÙˆØ¯": "Ø§Ù„Ø§Ø®ØªÙ„Ø§Ù ÙÙŠ Ù„ÙˆÙ† Ø§Ù„Ù„Ø­Ù… Ø¨Ø³Ø¨Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ¯Ø®ÙŠÙ† ÙˆØ§Ù„ØªÙ…Ù„ÙŠØ­ ÙˆØ§Ù„Ø·Ù‡ÙŠ ÙˆØ¯Ù‡ Ø¨ÙŠØ£Ø«Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø·Ø¹Ù….",
    "Ø§Ù„ØªÙˆÙ†Ø© Ù…Ø³ØªÙˆØ±Ø¯Ø© ÙˆÙ„Ø§ Ù…ØµØ±ÙŠ": "Ø§Ù„ÙƒØ§Ù†Ø² Ù…Ø³ØªÙˆØ±Ø¯ Ù„ÙƒÙ† Ø§Ù„ØªÙˆÙ†Ø© Ù†ÙØ³Ù‡Ø§ Ù…ØµØ±ÙŠØ© ÙˆÙŠØªÙ… ØµÙŠØ¯Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„Ù…ØªÙˆØ³Ø·.",
    "Ù„ÙŠÙ‡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºØ§Ù„ÙŠØ©": "Ù„Ø£Ù†Ù†Ø§ Ø¨Ù†Ø¶Ù…Ù† Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© ÙˆØ·Ø±ÙŠÙ‚Ø© ØªÙ…Ù„ÙŠØ­ ÙˆØªØ¯Ø®ÙŠÙ† Ù…Ø®ØªÙ„ÙØ©.",
    "ÙŠØ¹Ù†ÙŠ Ø§ÙŠÙ‡ ÙØ§ÙƒÙŠÙˆÙ…": "Ù…ØºÙ„Ù ÙÙŠ Ø¹Ø¨ÙˆØ§Øª Ù…ÙØ±ØºØ© Ø§Ù„Ù‡ÙˆØ§Ø¡.",
    "Ù†ÙˆØ¹ Ø§Ù„ØªÙˆÙ†Ø©": "ØªÙˆÙ†Ø© ÙŠÙ„ÙˆÙÙŠÙ†.",
    "Ø¨ØªØµØ·Ø§Ø¯ÙˆØ§ Ø§Ù„ØªÙˆÙ†Ø© Ù…Ù†ÙŠÙ†": "Ù…Ù† Ù…ØµØ± Ù…Ù† Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„Ù…ØªÙˆØ³Ø·.",
    "Ø§Ù„ØªÙˆÙ†Ø© Ø²ÙŠØª ÙˆÙ„Ø§ Ù…ÙŠØ§Ù‡": "ÙƒÙ„ Ø§Ù„ØªÙˆÙ†Ø© Ù…Ø¹Ø¨Ø£Ø© ÙÙŠ Ø²ÙŠØª Ù†Ø¨Ø§ØªÙŠ ÙÙ‚Ø·.",
    "Ù‡Ù„ ÙÙŠ Ù…ÙˆØ§Ø¯ Ø­Ø§ÙØ¸Ø©": "ÙƒÙ„ Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ§Ø¯ Ø­Ø§ÙØ¸Ø©.",
    "Ù‡Ù„ Ù…Ù…ÙƒÙ† Ø§Ø³Ø®Ù† Ø§Ù„Ø±Ù†Ø¬Ø©": "Ø±Ù†Ø¬Ø© Ø£Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯ Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø®ÙŠÙ†Ù‡Ø§ Ø£Ùˆ Ø·Ù‡ÙŠÙ‡Ø§ØŒ Ù‡ÙŠ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø£ÙƒÙ„.",
    "ØªÙˆØ§Ø¨Ù„ Ø§Ù„Ù…Ø§ÙƒØ±ÙŠÙ„ Ø§Ù„ÙÙŠÙ„ÙŠÙ‡": "ÙÙ„ÙÙ„ Ø£Ø³ÙˆØ¯ ÙˆÙÙ„ÙÙ„ Ø£Ø¨ÙŠØ¶.",
    "Ø¨Ø·Ø§Ø±Ø® Ø§Ù„Ø¨ÙˆØ±ÙŠ Ø¨Ø§Ù„Ø²Ø¨Ø¯Ø©": "Ø¨ØªÙƒÙˆÙ† Ø¨Ø·Ø§Ø±Ø® Ø¨ÙŠØ¶Ø§Ø¡ Ù†Ø´Ùˆ.",
    "Ø§Ù†ÙˆØ§Ø¹ Ø¨Ø·Ø§Ø±Ø® Ø§Ù„Ø±Ù†Ø¬Ø©": "Ù†ÙˆØ¹ Ù…Ø±Ù…Ù„Ø© Ù…Ù‡Ø±ÙˆØ³Ø© ÙˆÙ†ÙˆØ¹ Ù…Ø±Ù…Ù„Ø© ÙƒØ§Ù…Ù„Ø©.",
    "Ù‡Ù„ Ø§Ù„ØªÙˆÙ†Ø© Ø§Ù„Ù…Ø·Ù‡ÙŠØ© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§ÙƒÙ„": "Ø§Ù„ØªÙˆÙ†Ø© Ø§Ù„Ù…Ø·Ù‡ÙŠØ© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø£ÙƒÙ„ Ø¨Ø¯ÙˆÙ† Ø²ÙŠØª Ø£Ùˆ Ù…ÙŠØ§Ù‡ ÙˆÙ…Ø­ÙÙˆØ¸Ø© ÙØ§ÙƒÙŠÙˆÙ… ÙˆØ¨Ø£ÙˆØ²Ø§Ù† Ù…Ø®ØªÙ„ÙØ©.",
    "Ù‡Ù„ ÙÙŠ Ø³Ù…Ùƒ Ù…Ø¬Ù…Ø¯ Ø¨Ø¯ÙˆÙ† ØªØµÙ†ÙŠØ¹": "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³Ù…Ùƒ Ù…Ø¬Ù…Ø¯ Ø¨Ø¯ÙˆÙ† ØªØµÙ†ÙŠØ¹ ÙÙŠ Ø§Ù„Ù…ØµÙ†Ø¹.",
    "Ù†ÙˆØ¹ Ø§Ù„Ø³Ù„Ù…ÙˆÙ† Ù„Ù„Ø·Ù‡ÙŠ": "Ø§Ù„Ø³Ù„Ù…ÙˆÙ† Ø§Ù„ÙÙŠÙ„ÙŠÙ‡ Ø§Ù„Ù†ÙŠ."
}

PRODUCT_MAP = {
    "Smoked Herring": "ğŸ’° Ø³Ø¹Ø± Ø±Ù†Ø¬Ø© Ù…Ø¯Ø®Ù†Ø©: 1 KG Ø¨Ù€ 200 EGP âœ¨",
    "Salted Mullet without Bacteria": "ğŸ’° Ø³Ø¹Ø± ÙØ³ÙŠØ® Ø¨Ø¯ÙˆÙ† Ø¨ÙƒØªÙŠØ±ÙŠØ§: 1 KG Ø¨Ù€ 460 EGP âœ¨",
    "Salted Mullet with Roe": "ğŸ’° Ø³Ø¹Ø± ÙØ³ÙŠØ® Ù…Ø¨Ø·Ø±Ø®: 1 KG Ø¨Ù€ 560 EGP âœ¨",
    # ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø§ØµÙ„ÙŠ Ù…Ø®Ø²Ù†Ø© Ø¯Ø§Ø®Ù„ÙŠØ§Ù‹ ...
}

# ================== AI LOGIC (Groq) ==================
def get_ai_answer(user_text):
    # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…ÙØªØ§Ø­ ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±
    api_key = os.environ.get("GROQ_API_KEY")
    if not api_key: 
        return None
        
    try:
        url = "https://api.groq.com/openai/v1/chat/completions"
        headers = {
            "Authorization": f"Bearer {api_key}",
            "Content-Type": "application/json"
        }
        payload = {
            "model": "llama-3.1-70b-versatile",
            "messages": [
                {
                    "role": "system", 
                    "content": f"Ø£Ù†Øª Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡ Ø±Ù†Ø¬Ø© Ø£Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯ Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯. Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø© Ù„Ùƒ: {list(FAQ_MAP.values())}. Ø±Ø¯ Ø¨Ù„Ù‡Ø¬Ø© Ù…ØµØ±ÙŠØ© Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯ÙŠØ© Ø®ÙÙŠÙØ©ØŒ ÙƒÙ† ÙˆØ¯ÙˆØ¯Ø§Ù‹ Ø¬Ø¯Ø§Ù‹ ÙˆÙ…Ø±Ø­Ø§Ù‹ ÙˆØ´Ø¬Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨."
                },
                {"role": "user", "content": user_text}
            ],
            "temperature": 0.7
        }
        response = requests.post(url, json=payload, timeout=10)
        res_data = response.json()
        return res_data['choices'][0]['message']['content']
    except Exception as e:
        print(f"Error in Groq: {e}")
        return None

# ================== MAIN LOGIC ==================
def normalize(text):
    return (
        text.lower()
        .replace("Ø©", "Ù‡")
        .replace("Ø£", "Ø§")
        .replace("Ø¥", "Ø§")
        .replace("Ø¢", "Ø§")
        .strip()
    )

def get_answer(text):
    q = normalize(text)
    
    # 1. Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ (ÙŠØ¯ÙˆÙŠ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ù„Ù„Ø¯Ù‚Ø©)
    if any(w in q for w in ["Ø¯ÙˆØ¯", "Ù…Ø¯ÙˆØ¯", "Ø·ÙÙŠÙ„ÙŠØ§Øª"]):
        return FAQ_MAP["Ø§Ù„Ø±Ù†Ø¬Ø© ÙÙŠÙ‡Ø§ Ø¯ÙˆØ¯"]

    # 2. ğŸ”¥ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ø£ÙˆÙ„ÙˆÙŠØ© Ù‚ØµÙˆÙ‰ Ù„Ù„Ø¯Ø±Ø¯Ø´Ø© ÙˆØ§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©) ğŸ”¥
    # Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ ÙÙŠÙ‡ Ø£ÙƒØªØ± Ù…Ù† ÙƒÙ„Ù…Ø© Ø£Ùˆ ÙƒÙ„Ù…Ø§Øª Ø¯Ø±Ø¯Ø´Ø©ØŒ Ø§Ø¨Ø¹ØªÙ‡ Ù„Ù„Ù€ AI Ø§Ù„Ø£ÙˆÙ„
    chat_keywords = ["Ø§Ø²Ø§ÙŠ", "Ø·Ø±ÙŠÙ‚Ø©", "Ø§Ø¹Ù…Ù„", "ÙˆØµÙØ©", "Ø±Ø§ÙŠÙƒ", "Ø§ÙŠÙ‡Ù…Ø§", "Ø§Ø­Ù„Ù‰", "Ø§ÙØ¶Ù„", "Ø§ÙƒÙ„ Ø§ÙŠÙ‡", "ØªÙØªÙƒØ±"]
    
    # Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø·ÙˆÙŠÙ„ (Ø£ÙƒØªØ± Ù…Ù† 3 ÙƒÙ„Ù…Ø§Øª) Ø£Ùˆ ÙÙŠÙ‡ ÙƒÙ„Ù…Ø© Ø¯Ø±Ø¯Ø´Ø©ØŒ Ø®Ù„ÙŠÙ‡ ÙŠØ±ÙˆØ­ Ù„Ù„Ù€ AI
    if len(q.split()) > 3 or any(w in q for w in chat_keywords):
        ai_reply = get_ai_answer(text)
        if ai_reply:
            return ai_reply

    # 3. Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„ÙŠØ¯ÙˆÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (Ù„Ùˆ Ø§Ù„Ø¹Ù…ÙŠÙ„ ÙƒØªØ¨ ÙƒÙ„Ù…Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·)
    for key in FAQ_MAP.keys():
        if normalize(key) == q:
            return FAQ_MAP[key]

    if "ÙØ³ÙŠØ®" in q:
        return f"ğŸ’° Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ÙØ³ÙŠØ®:\n- {PRODUCT_MAP.get('Salted Mullet without Bacteria', '460 EGP')}\nØªØ­Ø¨ Ù†Ø¬Ù‡Ø²Ù„Ùƒ Ø£ÙˆØ±Ø¯Ø±ØŸ"
    
    if "Ø±Ù†Ø¬" in q:
        return f"ğŸ’° Ø³Ø¹Ø± Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ø³ÙˆØ¨Ø± 200Ø¬.\nØªØ­Ø¨ Ù†Ø¨Ø¹ØªÙ„Ùƒ Ø§Ù„Ù…Ù†ÙŠÙˆØŸ"

    # 4. Ø§Ù„Ù…Ù„Ø§Ø° Ø§Ù„Ø£Ø®ÙŠØ± Ù„Ùˆ ÙƒÙ„ Ø§Ù„Ù„ÙŠ ÙÙˆÙ‚ ÙØ´Ù„
    ai_reply = get_ai_answer(text)
    return ai_reply if ai_reply else "ÙŠØ§ Ù…Ø³Ø§Ø¡ Ø§Ù„ÙˆØ±Ø¯! Ù†ÙˆØ±Øª Ø±Ù†Ø¬Ø© Ø£Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯ØŒ Ø£Ø¤Ù…Ø±Ù†ÙŠ Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø¥Ø²Ø§ÙŠØŸ"
# ================== WEBHOOK & SERVER ==================
@app.route("/webhook", methods=["GET"])
def verify():
    if request.args.get("hub.verify_token") == VERIFY_TOKEN:
        return request.args.get("hub.challenge"), 200
    return "failed", 403

@app.route("/webhook", methods=["POST"])
def webhook():
    data = request.get_json()
    if data.get("object") == "page":
        for entry in data.get("entry", []):
            for ev in entry.get("messaging", []):
                sender = ev["sender"]["id"]
                if "message" in ev and "text" in ev["message"]:
                    msg_text = ev["message"]["text"]
                    reply = get_answer(msg_text)
                    send_message(sender, reply)
    return "ok", 200

def send_message(user_id, text):
    url = f"https://graph.facebook.com/v12.0/me/messages?access_token={PAGE_ACCESS_TOKEN}"
    payload = {"recipient": {"id": user_id}, "message": {"text": text}}
    try:
        requests.post(url, json=payload, timeout=10)
    except:
        pass

if __name__ == "__main__":
    port = int(os.environ.get("PORT", 8080))
    app.run(host="0.0.0.0", port=port)

