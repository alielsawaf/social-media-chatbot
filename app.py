from flask import Flask, request
from fuzzywuzzy import fuzz
import requests
import re
import os

app = Flask(__name__)

# ================== CONFIG ==================
PAGE_ACCESS_TOKEN = "EAARosZC3fHjUBQNm1eADUNlWqXKJZAtNB4w9upKF3sLLcZCdz14diiyFFeSipgiEi4Vx1PZAvu9b46xPcHv2wjIekD8LZAhDuAqgSOcrAiqzZBXr3Unk5k269G26dSMZB1wsiCvazanjVWcgdoh8M6AzkPn4xzQUUUQ8o3XLJ0V5s7MfnZAyZAzWF3VBDvP4IWFX5050XCmWWGQZDZD"
VERIFY_TOKEN = "my_secret_token"

# ================== MEMORY ==================
USER_CONTEXT = {} 

# ================== PRODUCTS ==================
# Ø­Ø§ÙØ¸Øª Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù„ÙŠ ÙƒØ§Ù†Øª Ø¹Ù†Ø¯Ùƒ (Ù…Ù…ÙƒÙ† ØªØ¶ÙŠÙ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨Ù†ÙØ³ Ø§Ù„Ù†Ù…Ø·)
PRODUCTS = [
      # Ø§Ù„Ø±Ù†Ø¬Ø©
    {'kw': ['Ø±Ù†Ø¬Ù‡ Ù…Ø¯Ø®Ù†Ù‡ Ù…Ø¨Ø·Ø±Ø®Ù‡ Ù…Ø±Ù…Ù„Ù‡', 'Ø±Ù†Ø¬Ù‡ Ù…Ø¨Ø·Ø±Ø®Ù‡', 'Ø±Ù†Ø¬Ù‡ Ù…Ø±Ù…Ù„Ù‡'], 'price': '250 EGP', 'w': '1 KG'},
    {'kw': ['Ø±Ù†Ø¬Ù‡ Ù…Ø¯Ø®Ù†Ù‡', 'Ø±Ù†Ø¬Ù‡ Ø¹Ø§Ø¯ÙŠÙ‡'], 'price': '200 EGP', 'w': '1 KG'},
    {'kw': ['Ø±Ù†Ø¬Ù‡ Ù…Ø¯Ø®Ù†Ù‡ 24 Ù‚ÙŠØ±Ø§Ø·', 'Ø±Ù†Ø¬Ù‡ 24', 'Ø±Ù†Ø¬Ù‡ Ø¹ÙŠØ§Ø± 24'], 'price': '300 EGP', 'w': '1 KG'},
    {'kw': ['Ø±Ù†Ø¬Ù‡ 24 Ù…Ø¨Ø·Ø±Ø®Ù‡', 'Ø±Ù†Ø¬Ù‡ 24 Ù…Ø±Ù…Ù„Ù‡'], 'price': '320 EGP', 'w': '1 KG'},
    {'kw': ['Ø±Ù†Ø¬Ù‡ Ù…Ù†Ø²ÙˆØ¹Ù‡ Ø§Ù„Ø§Ø­Ø´Ø§Ø¡ ÙØ§ÙƒÙŠÙˆÙ…', 'Ø±Ù†Ø¬Ù‡ ÙØ§ÙƒÙŠÙˆÙ…'], 'price': '300 EGP', 'w': '1 KG'},
    {'kw': ['Ø±Ù†Ø¬Ù‡ ÙÙŠÙ„ÙŠÙ‡ Ø¨Ø¯ÙˆÙ† Ø²ÙŠØª', 'Ø±Ù†Ø¬Ù‡ ÙÙŠÙ„ÙŠÙ‡ Ø³Ø§Ø¯Ù‡'], 'price': '600 EGP', 'w': '1 KG'},
    {'kw': ['Ø±Ù†Ø¬Ù‡ ÙÙŠÙ„ÙŠÙ‡ ØµÙˆØµ ÙÙ„ÙÙ„ ÙˆÙƒØ§ÙÙŠØ§Ø±'], 'price': '150 EGP', 'w': '200 G'},
    {'kw': ['Ø±Ù†Ø¬Ù‡ ÙÙŠÙ„ÙŠÙ‡ ÙƒØ§Ø±ÙŠ'], 'price': '250 EGP', 'w': '250 G'},
    {'kw': ['Ø±Ù†Ø¬Ù‡ ÙÙŠÙ„ÙŠÙ‡ Ø²ÙŠØª'], 'price': '250 EGP', 'w': '250 G'},
    {'kw': ['Ø±Ù†Ø¬Ù‡ ÙÙŠÙ„ÙŠÙ‡ Ù…Ø¯Ø®Ù†Ù‡'], 'price': '85 EGP', 'w': '125 G'},
    {'kw': ['ÙƒØ§ÙÙŠØ§Ø± Ø³Ø¨Ø±ÙŠØ¯', 'Ø±Ù†Ø¬Ù‡ ÙƒØ§ÙÙŠØ§Ø± Ø³Ø¨Ø±ÙŠØ¯'], 'price': '70 EGP', 'w': '200 G/130 G'},
    {'kw': ['Ø¨Ø·Ø§Ø±Ø® Ø±Ù†Ø¬Ù‡ Ø²ÙŠØª ÙƒØ§Ù…Ù„Ø©'], 'price': '250 EGP', 'w': '250 G'},
    {'kw': ['Ø¨Ø·Ø§Ø±Ø® Ø±Ù†Ø¬Ù‡ Ø¨Ø±ØªÙ‚Ø§Ù„', 'Ø¨Ø·Ø§Ø±Ø® Ù…Ù‡Ø±ÙˆØ³Ù‡'], 'price': '250 EGP', 'w': '250 G'},
    # Ø§Ù„Ù…Ø§ÙƒØ±ÙŠÙ„
    {'kw': ['Ù…Ø§ÙƒØ±ÙŠÙ„ Ù…Ø¯Ø®Ù† Ù…Ù…Ù„Ø­', 'Ù…Ø§ÙƒØ±ÙŠÙ„'], 'price': '410 EGP', 'w': '1 KG'},
    {'kw': ['Ù…Ø§ÙƒØ±ÙŠÙ„ ÙØ§ÙƒÙŠÙˆÙ…'], 'price': '460 EGP', 'w': '1 KG'},
    {'kw': ['Ù…Ø§ÙƒØ±ÙŠÙ„ ÙÙŠÙ„ÙŠÙ‡'], 'price': '800 EGP', 'w': '1 KG'},
    # Ø§Ù„ÙØ³ÙŠØ®
    {'kw': ['ÙØ³ÙŠØ® ÙÙŠÙ„ÙŠÙ‡ Ø²ÙŠØª', 'ÙØ³ÙŠØ® Ø²ÙŠØª'], 'price': '250 EGP', 'w': '250 G'},
    {'kw': ['ÙØ³ÙŠØ® ÙÙŠÙ„ÙŠÙ‡ Ø¯Ø®Ø§Ù†', 'ÙØ³ÙŠØ® Ù…Ø¯Ø®Ù†'], 'price': '250 EGP', 'w': '250 G'},
    {'kw': ['ÙØ³ÙŠØ® Ø³Ø¨Ø±ÙŠØ¯ Ø¨Ù†Ø¬Ø±'], 'price': '250 EGP', 'w': '250 G'},
    {'kw': ['ÙØ³ÙŠØ® Ø¨Ø¯ÙˆÙ† Ø¨ÙƒØªÙŠØ±ÙŠØ§', 'ÙØ³ÙŠØ® Ø·Ø¨ÙŠ'], 'price': '460 EGP', 'w': '1 KG'},
    {'kw': ['ÙØ³ÙŠØ® Ù…Ø¨Ø·Ø±Ø®'], 'price': '560 EGP', 'w': '1 KG'},
    {'kw': ['Ø´Ø±Ø§Ø¦Ø­ Ø¨ÙˆØ±ÙŠ Ù…Ø¯Ø®Ù†Ù‡', 'ÙÙŠÙ„ÙŠÙ‡ Ø¨ÙˆØ±ÙŠ Ù…Ø¯Ø®Ù†'], 'price': '810 EGP', 'w': '1 KG'},
    # Ø§Ù„Ø³Ù„Ù…ÙˆÙ†
    {'kw': ['Ø³Ù„Ù…ÙˆÙ† Ø­Ø§Ø±', 'spicy salmon'], 'price': '150 EGP', 'w': '125 G'},
    {'kw': ['Ø´Ø±Ø§Ø¦Ø­ Ø³Ù„Ù…ÙˆÙ† Ù…Ø¯Ø®Ù†Ù‡', 'Ø³Ù„Ù…ÙˆÙ† ÙÙŠÙ„ÙŠÙ‡'], 'price': '3000 EGP', 'w': '1 KG'},
    {'kw': ['Ø³ØªÙŠÙƒ Ø³Ù„Ù…ÙˆÙ†'], 'price': '1810 EGP', 'w': '1 KG'},
    {'kw': ['Ø´ÙˆØ±Ø¨Ù‡ Ø³Ù„Ù…ÙˆÙ†'], 'price': '90 EGP', 'w': '160 G'},
    # Ø§Ù„Ø¨Ø·Ø§Ø±Ø® ÙˆØ§Ù„ØªÙˆÙ†Ø©
    {'kw': ['Ø¨Ø·Ø§Ø±Ø® Ø¨ÙˆØ±ÙŠ Ù…Ù…Ù„Ø­Ù‡', 'Ø¨Ø·Ø§Ø±Ø® Ø¨ÙˆØ±ÙŠ'], 'price': '2850 EGP', 'w': '1 KG'},
    {'kw': ['ØªÙˆÙ†Ù‡ Ø­Ù…Ø±Ø§Ø¡ ÙÙŠÙ„ÙŠÙ‡', 'ØªÙˆÙ†Ù‡ Ø­Ù…Ø±Ø§'], 'price': '155 EGP', 'w': '230 G'},
    {'kw': ['ØªÙˆÙ†Ù‡ Ù‚Ø·Ø¹', ' chunks tuna'], 'price': '70 EGP', 'w': '125 G'},
    {'kw': ['ØªÙˆÙ†Ù‡ Ù…Ø·Ù‡ÙŠÙ‡'], 'price': '710 EGP', 'w': '1 KG'},
    # Ø£Ø®Ø±Ù‰
    {'kw': ['Ø§Ù†Ø´ÙˆØ¬Ù‡ ÙÙŠÙ„ÙŠÙ‡ Ø²ÙŠØª', 'Ø§Ù†Ø´ÙˆØ¬Ù‡'], 'price': '110 EGP', 'w': '125 G'},
    {'kw': ['Ø³Ø±Ø¯ÙŠÙ† Ù…Ù…Ù„Ø­'], 'price': '200 EGP', 'w': '250 G'},
    {'kw': ['Ø­Ù†Ø´Ø§Ù† Ù…Ø¯Ø®Ù†', 'ØªØ¹Ø¨Ø§Ù† Ù…Ø¯Ø®Ù†'], 'price': '810 EGP', 'w': '1 KG'}
]

# ================== FAQ (Ø§Ù„Ù€ 54 Ø³Ø¤Ø§Ù„ Ø¨ØªÙˆØ¹Ùƒ ÙƒØ§Ù…Ù„ÙŠÙ†) ==================
# ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ù„ØªØ´Ù…Ù„ ÙƒÙ„ Ø§Ù„ØµÙŠØº (Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ø­Ù„ÙŠ)
FAQ = [
    {
        "keywords": ["Ø¯ÙˆØ¯", "Ø·ÙÙŠÙ„ÙŠØ§Øª", "Ø¯ÙˆØ¯Ù‡", "Ù…Ø¯ÙˆØ¯Ù‡", "Ø­Ø§Ø¬Ù‡ ÙÙŠ Ø¨Ø·Ù†Ù‡Ø§"],
        "answer": "ÙÙ†Ø¯Ù… Ø¯Ù‡ Ù…Ø´ Ø¯ÙˆØ¯ Ø¯Ù‡ Ø¨ÙŠÙƒÙˆÙ† Ø·ÙÙŠÙ„ÙŠØ§Øª.. Ø§Ù„Ø·ÙÙŠÙ„ÙŠØ§Øª ÙÙŠ Ø³Ù…ÙƒÙ‡ Ø§Ù„Ø±Ù†Ø¬Ù‡ ØªÙˆØ¬Ø¯ ÙÙŠ Ø§Ù„ØªØ¬ÙˆÙŠÙ Ø§Ù„Ø¨Ø·Ù†ÙŠ Ù„Ø£Ù†Ù‡Ø§ ØªØ¯Ø®Ù„ ÙÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø§Ù…ØªØµØ§Øµ ÙˆØ§Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„ØºØ°Ø§Ø¦ÙŠ Ù„Ù„Ø³Ù…ÙƒÙ‡ ÙˆÙ‡ÙŠ Ù„Ø§ ØªØµÙŠØ¨ Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ùˆ Ø²ÙŠØ§Ø¯Ù‡ ÙÙŠ Ø§Ù„ÙˆÙ‚Ø§ÙŠÙ‡ ÙŠØªÙ… ØªØ¬Ù…ÙŠØ¯ Ø§Ù„Ø£Ø³Ù…Ø§Ùƒ Ø¹Ù†Ø¯ Ø¯Ø±Ø¬Ù‡ Ù…Ù† 35 Ø§Ù„ÙŠ 40 ØªØ­Øª Ø§Ù„ØµÙØ± Ù„ØªØµØ¨Ø­ Ø§Ù„Ø·ÙÙŠÙ„ÙŠØ§Øª Ø¬Ø²Ø¡ Ù…Ù† Ø§Ù„Ø£Ù…Ø¹Ø§Ø¡ ÙˆÙ„Ø§ ØªØ¤Ø«Ø± Ø¹Ù„ÙŠ Ø¢ÙƒÙ„Ù‡Ø§. Ø§Ù„Ø¯ÙˆØ¯ Ø¯Ù‡ Ù„Ùˆ Ø­ÙŠ Ù‡ÙŠÙƒÙˆÙ† ÙƒØ¯Ù‡ ÙÙŠ Ø®Ø·Ø± Ø¹Ù„ÙŠ ØµØ­Ø© Ø§Ù„Ø§Ù†Ø³Ø§Ù† Ùˆ Ø§Ù„Ø³Ù…ÙƒÙ‡ ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ù„Ù„Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ ... Ø­Ø¨ÙŠÙ† Ù†ÙˆØ¶Ø­ Ø§Ù…ØªÙ‰ ÙŠÙƒÙˆÙ† ÙÙŠ Ø¯ÙˆØ¯ Ø­ÙŠ ÙÙŠ Ø§Ù„Ø³Ù…ÙƒÙ‡ Ùˆ Ø¨ÙŠØ¬ÙŠ Ù…Ù†ÙŠÙ† ... Ø§Ù„Ø³Ù…Ùƒ Ø²ÙŠ Ø§Ù„Ø¥Ù†Ø³Ø§Ù† Ù„Ù…Ø§ Ø¨ÙŠÙ…ÙˆØª Ø¨ÙŠÙ…Ø± Ø¨Ù…Ø±Ø§Ø­Ù„ Ù‚Ø¨Ù„ Ù…Ø§ ÙŠÙˆØµÙ„ Ø§Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø¯ÙˆØ¯ Ù„Ø§Ø²Ù… ÙŠÙƒÙˆÙ† Ù…Ù†ØªÙØ® Ùˆ Ø¨Ø¹Ø¯ÙŠÙ† Ù…ØªØ¹ÙÙ† Ùˆ Ø¨Ø¹Ø¯Ù‡Ø§ Ù…ØªÙ‡ØªÙƒ Ùˆ Ø¨Ø¹Ø¯Ù‡Ø§ ÙŠÙƒÙˆÙ† ÙÙŠ Ø¯ÙˆØ¯ Ø­ÙŠ ... Ùˆ Ø§Ù„Ø³Ù…ÙƒÙ‡ Ø·Ø§Ù„Ù…Ø§ Ù…Ø´ Ù…Ù†ØªÙØ®Ù‡ Ø§Ùˆ Ù…ØªØ¹ÙÙ†Ù‡ Ø§Ùˆ Ù…ØªÙ‡ØªÙƒÙ‡ Ùˆ Ù…ÙÙŠÙ‡Ø§Ø´ ÙƒÙ„ Ø§Ù„Ø§Ø³Ø¨Ø§Ø¨ Ø§Ù„ØªÙŠ ØªØ¤Ø¯ÙŠ Ù„Ø¸Ù‡ÙˆØ± Ø¯ÙˆØ¯ Ø­ÙŠ ÙØ¯ÙŠ Ø·ÙÙŠÙ„ÙŠØ§Øª Ø¨ÙŠØªØºØ°ÙŠ Ø¹Ù„ÙŠÙ‡Ø§ Ø§Ù„Ø³Ù…Ùƒ"
    },
    {
        "keywords": ["Ù…Ù†ÙŠÙˆ", "Ø§Ø³Ø¹Ø§Ø±", "Ø§Ù„ÙƒØªØ§Ù„ÙˆØ¬", "Ù‚Ø§Ø¦Ù…Ù‡ Ø§Ù„Ø·Ø¹Ø§Ù…", "Ù„ÙŠÙ†Ùƒ Ø§Ù„Ù…Ù†ÙŠÙˆ"],
        "answer": "Ø¯Ø§ Ù„ÙŠÙ†Ùƒ Ù…Ù†ÙŠÙˆ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨ØªØ§Ø¹ØªÙ†Ø§ https://heyzine.com/flip-book/31946f16d5.html"
    },
    {
        "keywords": ["Ø§ØªØ§ÙƒØ¯ Ù…Ù†ÙŠÙ†", "Ø§Ù„Ø§ØµÙ„ÙŠ", "ØªÙ‚Ù„ÙŠØ¯", "Ø±Ù†Ø¬Ù‡ Ø§Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯ Ø§Ù„Ø§ØµÙ„ÙŠÙ‡"],
        "answer": "Ø§Ù„Ù…ØµØ¯Ø±: Ø­Ø§ÙˆÙ„ Ø´Ø±Ø§Ø¡ Ø±Ù†Ø¬Ø© Ø£Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯ Ù…Ù† Ù…ØµØ§Ø¯Ø± Ù…ÙˆØ«ÙˆÙ‚Ø© Ù„Ø¶Ù…Ø§Ù† Ø­ØµÙˆÙ„Ùƒ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø£ØµÙ„ÙŠ"
    },
    {
        "keywords": ["Ø¬Ù…Ù„Ù‡", "Ø§Ø³Ø¹Ø§Ø± Ø§Ù„Ø¬Ù…Ù„Ù‡", "ÙƒÙ…ÙŠØ§Øª", "ØªØ§Ø¬Ø±", "Ø¹Ø§ÙŠØ² ÙƒÙ…ÙŠÙ‡"],
        "answer": "Ù„Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ùˆ Ø·Ù„Ø¨ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙŠØ±Ø¬ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù„ÙŠ Ø§Ø±Ù‚Ø§Ù… Ø§Ù„Ù…ØµÙ†Ø¹ : 01211113882"
    },
    {
        "keywords": ["Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª", "Ø³Ø§Ù†Ø¯ÙˆØªØ´", "Ø³Ù„Ø§Ø·Ù‡", "ØªÙˆØµÙŠÙ„ Ø³Ù†Ø¯ÙˆØªØ´Ø§Øª"],
        "answer": "Ù…Ù†ÙŠÙˆ Ø§Ù„Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´Ø§Øª Ùˆ Ø§Ù„Ø³Ù„Ø·Ø© ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§ ÙˆÙ„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆØµÙŠÙ„ Ù„Ù„Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´Ø§Øª Ùˆ Ø§Ù„Ø³Ù„Ø·Ø©"
    },
    {
        "keywords": ["Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„ÙØ±ÙˆØ¹", "Ø¨ØªÙØªØ­ÙˆØ§ Ø§Ù…ØªÙ‰", "Ø´ØºØ§Ù„ÙŠÙ† Ù„Ù„Ø³Ø§Ø¹Ù‡ ÙƒØ§Ù…", "Ù…Ù† ÙƒØ§Ù… Ù„ÙƒØ§Ù…"],
        "answer": "Ù…Ù† Ù¡Ù  ØµØ¨Ø§Ø­Ø§ Ù„Ù„Ø³Ø§Ø¹Ù‡ Ù¡Ù¢ Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„"
    },
    {
        "keywords": ["ØªØµØ¯ÙŠØ±", "Ø¨Ø±Ø§ Ù…ØµØ±", "Ø´Ø­Ù† Ø¯ÙˆÙ„ÙŠ", "Ø§Ø­Ù…Ø¯ Ø¨ØªØ§Ø¹ Ø§Ù„ØªØµØ¯ÙŠØ±"],
        "answer": "01272475555 Ø§Ø³ØªØ§Ø° Ø§Ø­Ù…Ø¯ Ø­Ø¶Ø±ØªÙƒ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ø§Ù‡ ÙˆØ§ØªØ³Ø§Ø¨ Ù‡ÙŠØ³Ø§Ø¹Ø¯ Ø­Ø¶Ø±ØªÙƒ"
    },
    {
        "keywords": ["Ù…Ø´ØªØ±ÙŠØ§Øª", "Ø±Ù‚Ù… Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª", "Ø§Ø¯Ø§Ø±Ù‡ Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª"],
        "answer": "Ø±Ù‚Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª : 01223066445"
    },
    {
        "keywords": ["ØªÙˆØ¸ÙŠÙ", "Ø´ØºÙ„", "ÙˆØ¸Ø§Ø¦Ù", "Ø§ØªØ´ Ø§Ø±", "hr"],
        "answer": "Ø±Ù‚Ù… Ø§Ø¯Ø§Ø±Ø© Ø§Ù„HR ÙÙŠ Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯ : 01200056103"
    },
    {
        "keywords": ["Ø§Ø´ÙˆÙŠ", "Ù†Ø§Ø±", "Ø§Ø³Ø®Ù†", "ØªØ³Ø®ÙŠÙ†", "Ø¨ÙˆØªØ§Ø¬Ø§Ø²", "Ø´ÙˆÙŠ"],
        "answer": "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù†Ø¬Ø© Ù„Ù„Ø´ÙˆÙŠ ÙˆÙ„Ø§ ØªØªØ¹Ø±Ø¶ Ù„Ø§ÙŠ Ø­Ø±Ø§Ø±Ø© Ø§Ù„Ø±Ù†Ø¬Ø© Ù„Ø¯ÙŠÙ†Ø§ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø§ÙƒÙ„ Ù…Ø¨Ø§Ø´Ø±Ø© ÙˆÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø¯Ù‡Ù†Ù‡Ø§ Ø¨Ø§Ù„Ø²ÙŠØª"
    },
    {
        "keywords": ["Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¬Ù…Ø¯Ù‡ ÙˆØ§Ù„ÙØ±ÙŠØ´", "Ù…Ø¬Ù…Ø¯Ù‡", "ÙØ±ÙŠØ´", "ØµÙ„Ø§Ø­ÙŠÙ‡"],
        "answer": "Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ù…Ø¬Ù…Ø¯Ø© Ùˆ Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„ÙØ±ÙŠØ´: Ø§Ù„Ø±Ù†Ø¬Ù‡ Ø§Ù„Ù…Ø¬Ù…Ø¯Ù‡ .. ØªØ­ÙØ¸ ÙÙŠ Ø¯Ø±Ø¬Ù‡ Ø­Ø±Ø§Ø±Ù‡ -18ØŒ ØµÙ„Ø§Ø­ÙŠÙ‡ 3 Ø´Ù‡ÙˆØ±ØŒ ØªØ­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ¬Ù…ÙŠØ¯ Ùˆ Ù„ÙŠØ³ Ø§Ù„ØªØ¨Ø±ÙŠØ¯. Ø§Ù„Ø±Ù†Ø¬Ù‡ Ø§Ù„ÙØ±ÙŠØ´.. ØªØ­ÙØ¸ ÙÙŠ Ø¯Ø±Ø¬Ù‡ Ø­Ø±Ø§Ø±Ù‡ 0 Ø§Ù„ÙŠ 4ØŒ ØµÙ„Ø§Ø­ÙŠÙ‡ Ø´Ù‡Ø±ØŒ ØªØ­ÙØ¸ ÙÙŠ Ø§Ù„ØªØ¨Ø±ÙŠØ¯ (Ø¯Ø±Ø¬Ù‡ Ø­Ø±Ø§Ø±Ù‡ Ø§Ù„Ø«Ù„Ø§Ø¬Ù‡)"
    },
    {
        "keywords": ["ÙˆØ²Ù† Ø§Ù„ÙƒØ±ØªÙˆÙ†Ù‡", "ÙƒØ±ØªÙˆÙ†Ù‡ Ø§Ù„Ø±Ù†Ø¬Ù‡ ÙƒØ§Ù… ÙƒÙŠÙ„Ùˆ"],
        "answer": "ÙˆØ²Ù† ÙƒØ±ØªÙˆÙ†Ø© Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ù…Ø¬Ù…Ø¯Ù‡ Ø§Ù„ÙƒØ±ØªÙˆÙ†Ù‡ Ø¨ØªÙƒÙˆÙ† Ù…Ù† 7.5 Ù„ 8 ÙƒÙŠÙ„Ùˆ ÙŠØ§ ÙÙ†Ø¯Ù…"
    },
    {
        "keywords": ["Ø§Ù„ÙƒÙŠØ³ Ø§Ù„Ø§Ø³ÙˆØ¯ ÙˆØ§Ù„Ø¬ÙˆÙ„Ø¯", "ÙØ§ÙƒÙŠÙˆÙ… Ø¬ÙˆÙ„Ø¯", "ØªØºÙ„ÙŠÙ"],
        "answer": "Ø§Ù„Ø­Ø¬Ù… Ø§Ù„ØµØºÙŠØ± Ø¨ØªÙƒÙˆÙ† ÙÙ‰ Ø§Ù„ØªØºÙ„ÙŠÙ Ø§Ù„Ø¬ÙˆÙ„Ø¯ ( Ø§Ù„ÙØ§ÙƒÙŠÙˆÙ… ) Ø§Ù‚ØµÙ‰ Ø­Ø¬Ù… Ø¨ØªÙƒÙˆÙ† 600 Ø¬Ø±Ø§Ù… - Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø§ÙƒØ¨Ø± Ø¨ØªÙƒÙˆÙ† ÙÙ‰ Ø§Ù„ØªØºÙ„ÙŠÙ Ø§Ù„Ø§Ø³ÙˆØ¯ Ù…Ù…ÙƒÙ† ØªÙˆØµÙ„ Ø­Ø¬Ù…Ù‡Ø§ Ù„ÙƒÙŠÙ„Ùˆ Ø§Ùˆ ÙƒÙŠÙ„Ùˆ Ùˆ 200 Ø§Ùˆ 800 Ø¬Ø±Ø§Ù… ÙŠØ§ ÙÙ†Ø¯Ù…"
    },
    {
        "keywords": ["Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø¹Ø§Ø¯ÙŠÙ‡ Ùˆ 24", "ÙŠØ¹Ù†ÙŠ Ø§ÙŠÙ‡ 24", "Ù…ÙŠØ²Ù‡ 24"],
        "answer": "- ÙÙŠ Ø¹ÙŠØ§Ø± 24 Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ¯Ø®ÙŠÙ† Ø§Ø·ÙˆÙ„ Ù…Ù† Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© - ÙÙŠ Ø¹ÙŠØ§Ø± 24 Ø­Ø¬Ù… Ø§Ù„Ø³Ù…ÙƒØ© Ø§ØµØºØ± Ù…Ù† Ø­Ø¬Ù… Ø§Ù„Ø³Ù…ÙƒØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© - ÙÙŠ Ø¹ÙŠØ§Ø± 24 Ø·Ø¹Ù… Ø§Ù„ØªØ¯Ø®ÙŠÙ† Ø¨ÙŠÙƒÙˆÙ† Ù…Ø¹Ø²Ø² Ø§ÙƒØ«Ø± Ù„Ø§Ù† Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ¯Ø®ÙŠÙ† Ø¨ØªÙƒÙˆÙ† Ø§Ø²ÙŠØ¯ Ù…Ù† Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„ØªØ¯Ø®ÙŠÙ† ÙÙŠ Ø§Ù„Ø³Ù…ÙƒØ© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©"
    },
    {
        "keywords": ["Ø§Ø­ÙØ¸Ù‡Ø§ Ø§Ø²Ø§ÙŠ", "ØªØ®Ø²ÙŠÙ†", "Ø§Ù„ÙØ±ÙŠØ²Ø± ÙˆÙ„Ø§ Ø§Ù„Ø«Ù„Ø§Ø¬Ù‡", "Ø´ÙŠÙ„ Ø§Ù„Ø±Ù†Ø¬Ù‡"],
        "answer": "ÙŠÙØ¶Ù„ Ø§Ù† ØªØ­ÙØ¸ ÙÙŠ Ø§Ù„ÙØ±ÙŠØ²Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡"
    },
    {
        "keywords": ["ÙŠØ¹Ù†ÙŠ Ø§ÙŠÙ‡ ÙØ§ÙƒÙŠÙˆÙ…", "ØªØºÙ„ÙŠÙ Ù…ÙØ±Øº"],
        "answer": "Ø±Ù†Ø¬Ø© ÙÙŠ Ø¹Ø¨ÙˆØ§Øª Ù…ÙØ±ØºØ© Ø§Ù„Ù‡ÙˆØ§Ø¡"
    },
    {
        "keywords": ["ØªÙ…Ù„ÙŠØ­ Ø§Ù„ÙØ³ÙŠØ®", "Ø¨ÙŠØªÙ…Ù„Ø­ Ø§Ø²Ø§ÙŠ", "Ø¨ÙˆØ±ÙŠ ÙØ³ÙŠØ®"],
        "answer": "ÙŠØªÙ… Ø¹Ù…Ù„ Ø§Ù„ÙØ³ÙŠØ® Ù…Ù† Ø³Ù…Ùƒ Ø§Ù„Ø¨ÙˆØ±ÙŠ *ÙŠØªÙ… ØªÙ…Ù„ÙŠØ­ Ø§Ù„ÙØ³ÙŠØ® ÙØ±ÙŠØ´ Ù„Ø§ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„Ø¨ÙƒØªÙŠØ±ÙŠ *ÙŠØªÙ… ØªÙ…Ù„ÙŠØ­ Ø§Ù„ÙØ³ÙŠØ® ØªÙ…Ù„ÙŠØ­ Ø¬Ø§Ù *ÙŠØ­ÙØ¸ Ø§Ù„ÙØ³ÙŠØ® Ø¯Ø§Ø®Ù„ Ø«Ù„Ø§Ø¬Ø§Øª Ø¨Ø¯Ø±Ø¬Ø§Øª Ø­Ø±Ø§Ø±Ø© Ù…Ù† 0 Ø§Ù„ÙŠ 4 Ù„Ø§ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„Ø¨ÙƒØªÙŠØ±ÙŠ"
    },
    {
        "keywords": ["ØªÙˆÙ†Ù‡ Ø¨ÙŠØ¶Ø§Ø¡ ÙˆØ­Ù…Ø±Ø§Ø¡", "Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ù„Ø­Ù… Ø§Ù„ØªÙˆÙ†Ù‡"],
        "answer": "Ø§Ù„Ù„Ø­Ù… Ø§Ù„Ø§Ø¨ÙŠØ¶ Ø§ÙØªØ­ Ù…Ù† Ø§Ù„Ù„Ø­Ù… Ø§Ù„Ø§Ø­Ù…Ø± Ù„Ø§Ù† Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø­Ù…Ø± ÙÙŠ Ù„Ø­Ù… Ø§Ù„ØªÙˆÙ†Ù‡ Ø¨ÙŠØ¬ÙŠ Ù…Ù† Ø§Ù„Ù…ÙŠÙˆØºÙ„ÙˆØ¨ÙŠÙ† ÙˆØ§Ù„Ù‡ÙŠÙ…ÙˆØ¬Ù„ÙˆØ¨ÙŠÙ† ØŒ Ø§Ù„Ù…ÙŠÙˆØºÙ„ÙˆØ¨ÙŠÙ† Ù‡Ùˆ Ø¨Ø±ÙˆØªÙŠÙ† ÙŠØ­Ù…Ù„ Ø§Ù„Ø£ÙƒØ³Ø¬ÙŠÙ† Ù„Ø°Ù„Ùƒ ÙŠÙƒÙˆÙ† Ø§Ù„Ù„Ø­Ù… Ø§Ù„Ø§Ø­Ù…Ø± ÙÙŠ Ø§Ù„ØªÙˆÙ†Ø© Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯Ù‡ ÙÙŠÙ‡ Ø§Ø¹Ù„ÙŠ Ù…Ù† Ø§Ù„ØªÙˆÙ†Ù‡ Ø§Ù„Ø¨ÙŠØ¶Ø§Ø¡ Ù„Ø­Ù… Ø§Ù„ØªÙˆÙ†Ø© Ø§Ù„Ø§Ø­Ù…Ø± Ø¨ÙŠÙƒÙˆÙ† Ø·Ø±ÙŠ Ø§ÙƒØ«Ø± Ù…Ù† Ù„Ø­Ù… Ø§Ù„ØªÙˆÙ†Ø© Ø§Ù„Ø§Ø¨ÙŠØ¶ Ø¨Ø³Ø¨Ø¨ Ø²ÙŠØ§Ø¯Ø© Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† ÙÙŠÙ‡"
    },
    {
        "keywords": ["Ø¯Ù… ÙÙŠ Ø§Ù„ÙØ³ÙŠØ®", "Ø§Ù„ÙØ³ÙŠØ® ÙÙŠÙ‡ Ø¯Ù…", "Ø³ÙˆØ§Ø¦Ù„ Ø­Ù…Ø±Ø§Ø¡"],
        "answer": "ÙŠØ§ ÙÙ†Ø¯Ù… Ø§Ù„Ø³Ù…ÙƒÙ‡ Ø¬Ø§Ù‡Ø²Ù‡ Ø¹Ù„ÙŠ Ø§Ù„Ø§ÙƒÙ„ Ùˆ Ø§Ù„Ø¯Ù… Ø¯Ù‡ Ø¨ÙŠÙƒÙˆÙ† Ø¨Ø³Ø¨Ø¨ Ø§Ù† Ø§Ù„Ø³Ù…ÙƒÙ‡ Ø¨ØªØªÙ…Ù„Ø­ ÙØ±ÙŠØ´ Ùˆ Ø¨ÙŠØªÙ… Ø­ÙØ¸Ù‡Ø§ Ø¨Ø¹Ø¯ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙ…Ù„ÙŠØ­ ÙÙŠ Ø§Ù„ØªØ¬Ù…ÙŠØ¯ Ùˆ Ø¹Ù†Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨ØªØ®Ø±Ø¬ Ù…Ù† Ù…Ø±Ø­Ù„Ù‡ Ø§Ù„ØªØ¬Ù…ÙŠØ¯ Ù Ø§Ù„Ø³Ù…ÙƒÙ‡ Ø¨ØªÙÙƒ Ø¹Ø´Ø§Ù† ÙƒØ¯Ù‡ ÙÙŠ Ø§Ù„Ø³ÙˆØ§Ø¦Ù„ (Ø¯Ù…)"
    },
    {
        "keywords": ["ÙÙŠÙ„ÙŠÙ‡ Ù†Ø§Ø´ÙÙ‡", "Ø§Ù„Ø±Ù†Ø¬Ù‡ Ø§Ù„ÙÙŠÙ„ÙŠÙ‡ Ù†Ø§Ø´ÙÙ‡"],
        "answer": "Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„ÙÙŠÙ„ÙŠØ© Ø¨ØªÙƒÙˆÙ† Ù…Ø®Ù„ÙŠØ© ÙˆÙˆØ§Ø®Ø¯Ù‡ 3 Ø·Ø¨Ù‚Ø§Øª Ø³Ù…ÙˆÙƒ Ù„ØªØ¹Ø²ÙŠØ² Ø·Ø¹Ù… Ø§Ù„ØªØ¯Ø®ÙŠÙ† ÙÙŠÙ‡Ø§ Ø¹Ø´Ø§Ù† ÙƒØ¯Ù‡ Ø¨ØªÙƒÙˆÙ† Ø§Ù†Ø´Ù Ø´ÙˆÙŠÙ‡ Ù…Ù† Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠÙ‡"
    },
    {
        "keywords": ["Ø­Ø³Ø§Ø¨Ø§Øª", "Ù…Ø§Ù„ÙŠØ§Øª", "Ø¨Ù†ÙˆÙƒ", "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù…Ø§Ø¹"],
        "answer": "01204464066 Ø§Ø³ØªØ§Ø° Ù…Ø­Ù…Ø¯ Ø§Ù„Ø´Ù…Ø§Ø¹ Ù…Ø¯ÙŠØ± Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ù…ÙƒÙ† ÙŠØ³Ø§Ø¹Ø¯ Ø­Ø¶Ø±ØªÙƒ"
    },
    {
        "keywords": ["ÙÙ†Ø§Ø¯Ù‚", "Ù…Ø·Ø§Ø¹Ù…", "ØªÙˆØ±ÙŠØ¯", "Ø§Ø³ØªØ§Ø° Ø¨Ù„Ø§Ù„"],
        "answer": "Ø¯Ø© Ø±Ù‚Ù… Ø§Ù„Ø§Ø³ØªØ§Ø° Ø¨Ù„Ø§Ù„ ÙŠØ§ÙÙ†Ø¯Ù… Ù…Ø³Ø¤Ù„ Ø§Ù„ØªÙˆØ±ÙŠØ¯ ØªÙ‚Ø¯Ø± ØªØªÙˆØ§ØµÙ„ Ù…Ø¹Ø§Ø© Ùˆ Ù‡ÙŠØ³Ø§Ø¹Ø¯ Ø­Ø¶Ø±ØªÙƒ 01221093951"
    },
    {
        "keywords": ["ØªÙˆÙ†Ù‡ Ù…ØµØ±ÙŠ", "ØªÙˆÙ†Ù‡ Ù…Ø³ØªÙˆØ±Ø¯Ù‡"],
        "answer": "Ø§Ù„ÙƒØ§Ù†Ø² Ø§Ù„ØªÙˆÙ†Ø© Ø¨ÙŠÙƒÙˆÙ† Ù…Ø³ØªÙˆØ±Ø¯ Ùˆ Ù…Ø·Ø¨ÙˆØ¹ Ùˆ Ø¯Ø§ Ø§Ù„ÙƒØ§Ù† Ù†ÙØ³Ù‡ Ù…Ø´ Ø§Ù„Ø³Ù…ÙƒØ© Ù„ÙƒÙ† Ø§Ù„ØªÙˆÙ†Ø© Ø§Ù„ÙŠ Ø¹Ù†Ø¯Ù†Ø§ Ù…Ø´ Ù…Ø³ØªÙˆØ±Ø¯Ø© ØªÙˆÙ†Ø© Ù…ØµØ±ÙŠØ© Ùˆ Ø¨Ù†ØµØ·Ø§Ø¯Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø§Ø¨ÙŠØ¶ Ø§Ù„Ù…ØªÙˆØ³Ø·"
    },
    {
        "keywords": ["Ù„ÙŠÙ‡ ØºØ§Ù„ÙŠÙ‡", "Ø§Ù„Ø§Ø³Ø¹Ø§Ø± ØºØ§Ù„ÙŠÙ‡", "ØºØ§Ù„ÙŠÙ‡ Ù„ÙŠÙ‡"],
        "answer": "Ù„Ø§Ù†Ù†Ø§ Ø¨Ù†Ø¶Ù…Ù†Ù„Ùƒ Ø¬ÙˆØ¯Ø© Ù…Ù†ØªØ¬ ÙŠØ§ ÙÙ†Ø¯Ù… Ø­ÙŠØ« Ø§Ù† Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙ…Ù„ÙŠØ­ Ùˆ Ø§Ù„ØªØ¯Ø®ÙŠÙ† Ù…Ø®ØªÙ„ÙÙ‡ØŒ Ø§Ø­Ù†Ø§ Ø¨Ù†Ù…Ù„Ø­ Ø³Ù…Ùƒ Ø§Ù„Ø±Ù†Ø¬Ø© Ø¨Ù…Ø­Ù„ÙˆÙ„ Ø¨Ø±Ø§ÙŠÙ† Ùˆ Ø¨ÙŠØªÙ… ØªØ¯Ø®ÙŠÙ† Ø§Ù„Ø³Ù…Ùƒ Ø¹Ù„ÙŠ Ø§Ù„Ø¨Ø§Ø±Ø¯ Ø¨Ù†Ø´Ø§Ø±Ø© Ø§Ù„Ù…Ø§Ù†ÙŠ Ø¹Ø´Ø§Ù† Ù†Ø¶Ù…Ù† Ù„Ø­Ø¶Ø±ØªÙƒ Ù…Ù†ØªØ¬ ØµØ­ÙŠ Ù…Ø¯Ø®Ù† Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø¬Ø§Ù‡Ø² Ø¹Ù„ÙŠ Ø§Ù„Ø§ÙƒÙ„"
    },
    {
        "keywords": ["Ù†ÙˆØ¹ Ø§Ù„ØªÙˆÙ†Ù‡", "Ø¨ØªØ³ØªØ®Ø¯Ù…ÙˆØ§ ØªÙˆÙ†Ù‡ Ø§ÙŠÙ‡"],
        "answer": "ØªÙˆÙ†Ø© ÙŠÙ„ÙˆÙÙŠÙ†"
    },
    {
        "keywords": ["Ù…ÙˆØ§Ø¯ Ø­Ø§ÙØ¸Ù‡"],
        "answer": "ÙƒÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù†Ø¯Ù†Ø§ Ø¨Ø¯ÙˆÙ† Ù…ÙˆØ§Ø¯ Ø­Ø§ÙØ¸Ø©"
    }
    # ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ù€ 54 Ù‡Ù†Ø§ Ø¨Ù†ÙØ³ Ø§Ù„Ù†Ù…Ø·
]

# ================== UTILS ==================
# ================== 1. ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªØ£ÙƒÙŠØ¯ ==================
CONFIRMATION_WORDS = ['Ø§Ù‡', 'Ø§ÙŠÙˆÙ‡', 'Ø§ÙŠÙˆØ©', 'Ù…Ø§Ø´ÙŠ', 'ØªÙ…Ø§Ù…', 'ÙŠØ§Ø±ÙŠØª', 'Ù‚ÙˆÙ„ÙŠ', 'ÙˆØ±ÙŠÙ†ÙŠ', 'Ø·Ø¨Ø¹Ø§', 'ÙŠØ§ Ø±ÙŠØª', 'Ø§Ø´Ø·Ù‡']

# ================== 2. Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ (Ø£ÙƒØ«Ø± Ø°ÙƒØ§Ø¡Ù‹) ==================
def detect_product(text):
    q = clean(text)
    best_p = None
    max_score = 0
    
    for p in PRODUCTS:
        for k in p["kw"]:
            target = clean(k)
            # ÙØ­Øµ Ù„Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ "Ø¬Ø²Ø¡" Ù…Ù† ÙƒÙ„Ø§Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ (Ø¹Ø´Ø§Ù† ÙŠÙÙ‡Ù… "ÙÙŠ Ø¨Ø·Ø§Ø±Ø®")
            if target in q or fuzz.partial_ratio(target, q) > 85:
                # Ù†Ø¯ÙŠ Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø·ÙˆÙ„ (Ø¹Ø´Ø§Ù† Ø¨Ø·Ø§Ø±Ø® Ø±Ù†Ø¬Ø© ØªØºÙ„Ø¨ ÙƒÙ„Ù…Ø© Ø±Ù†Ø¬Ø©)
                score = len(target) 
                if score > max_score:
                    max_score = score
                    best_p = p
    return best_p

# ================== 3. Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø·ÙˆØ± Ù„Ù„Ø±Ø¯ ==================
def get_answer(user_id, text):
    try:
        # 1. ØªÙ†Ø¸ÙŠÙ Ø£ÙˆÙ„ÙŠ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø³Ù„Ø§Ù…
        raw_q = text.lower().strip()
        q_cleaned = clean(text)

        # Ù‚Ø§Ø¦Ù…Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø³Ù„Ø§Ù… (ÙØ­Øµ Ù…Ø¨Ø§Ø´Ø± Ù‚Ø¨Ù„ Ø£ÙŠ ØªØ¹Ù‚ÙŠØ¯)
        if any(w in raw_q for w in ['Ø§Ù‡Ù„Ø§', 'Ø³Ù„Ø§Ù…', 'Ø§Ø²ÙŠÙƒ', 'Ù‡Ø§ÙŠ', 'ØµØ¨Ø§Ø­', 'Ù…Ø³Ø§Ø¡', 'Ù…Ø±Ø­Ø¨Ø§', 'Ù‡Ù„Ùˆ']):
            return "Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø±Ù†Ø¬Ø© Ø£Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯ ğŸ‘‹ Ù†ÙˆØ±ØªÙ†Ø§.. Ø­Ø§Ø¨Ø¨ ØªØ¹Ø±Ù Ø£Ø³Ø¹Ø§Ø±Ù†Ø§ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø© ÙˆÙ„Ø§ Ø¹Ù†Ø¯Ùƒ Ø§Ø³ØªÙØ³Ø§Ø±ØŸ âœ¨"

        # 2. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        product = detect_product(text)
        
        # Ø°ÙƒØ§Ø¡ Ø¥Ø¶Ø§ÙÙŠ: Ù„Ùˆ Ù…Ù„Ù‚Ø§Ø´ Ù…Ù†ØªØ¬ ØµØ±ÙŠØ­ Ø¨Ø³ Ù„Ù‚Ù‰ ÙƒÙ„Ù…Ø© (ØªÙˆÙ†Ù‡ØŒ ÙØ³ÙŠØ®ØŒ Ø±Ù†Ø¬Ù‡) ÙÙŠ Ø§Ù„Ø¬Ù…Ù„Ø©
        if not product:
            if 'ØªÙˆÙ†Ù‡' in q_cleaned: 
                product = next((p for p in PRODUCTS if 'ØªÙˆÙ†Ù‡' in p['kw'][0]), None)
            elif 'ÙØ³ÙŠØ®' in q_cleaned: 
                product = next((p for p in PRODUCTS if 'ÙØ³ÙŠØ®' in p['kw'][0]), None)
            elif 'Ø±Ù†Ø¬Ù‡' in q_cleaned: 
                product = next((p for p in PRODUCTS if 'Ø±Ù†Ø¬Ù‡' in p['kw'][0]), None)

        # ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø¥Ø°Ø§ ÙˆØ¬Ø¯ Ù…Ù†ØªØ¬
        if product:
            USER_CONTEXT[user_id] = product

        # 3. ÙØ­Øµ ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªØ£ÙƒÙŠØ¯ (Ø§Ù‡ØŒ ÙŠØ§Ø±ÙŠØªØŒ ØªÙ…Ø§Ù…)
        CONFIRMATION_WORDS = ['Ø§Ù‡', 'Ø§ÙŠÙˆÙ‡', 'Ù…Ø§Ø´ÙŠ', 'ØªÙ…Ø§Ù…', 'ÙŠØ§Ø±ÙŠØª', 'ÙŠØ§ Ø±ÙŠØª', 'Ù‚ÙˆÙ„ÙŠ', 'ÙˆØ±ÙŠÙ†ÙŠ', 'Ø·Ø¨Ø¹Ø§']
        is_confirm = any(word == q_cleaned for word in CONFIRMATION_WORDS) or (q_cleaned in CONFIRMATION_WORDS)

        # 4. ÙØ­Øµ Ø·Ù„Ø¨ Ø§Ù„Ø³Ø¹Ø±
        is_price_req = any(x in q_cleaned for x in ["Ø³Ø¹Ø±", "Ø¨ÙƒØ§Ù…", "ÙƒØ§Ù…", "Ù‚Ø¯ Ø§ÙŠÙ‡", "ÙÙ„ÙˆØ³", "Ø¨ÙƒÙ…"])

        if is_price_req or is_confirm:
            p = product or USER_CONTEXT.get(user_id)
            if p:
                return f"ğŸ’° Ø³Ø¹Ø± {p['kw'][0]}:\nØ§Ù„ÙˆØ²Ù†: {p['w']}\nØ§Ù„Ø³Ø¹Ø±: {p['price']} âœ¨"
            if is_price_req:
                return "ØªØ­Ø¨ ØªØ¹Ø±Ù Ø³Ø¹Ø± Ø£Ù†Ù‡ÙŠ ØµÙ†ÙØŸ ğŸ˜Š (Ù…ØªØ§Ø­ Ø±Ù†Ø¬Ø©ØŒ ÙØ³ÙŠØ®ØŒ Ø¨Ø·Ø§Ø±Ø®ØŒ ØªÙˆÙ†Ø©..)"

        # 5. Ø§Ù„Ù€ FAQ (Ø§Ù„Ù€ 54 Ø³Ø¤Ø§Ù„)
        for f in FAQ:
            for kw in f["keywords"]:
                # ÙØ­Øµ Ø¨Ø§Ù„Ø§Ø­ØªÙˆØ§Ø¡ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ø£Ùˆ Ù†Ø³Ø¨Ø© Ø§Ù„ØªØ´Ø§Ø¨Ù‡
                if clean(kw) in q_cleaned or fuzz.partial_ratio(clean(kw), q_cleaned) > 85:
                    return f["answer"]

        # 6. Ø¥Ø°Ø§ Ø°ÙƒØ± Ø§Ù„Ù…Ù†ØªØ¬ ÙÙ‚Ø· (Ù…Ø«Ù„: "ÙÙŠ Ø¨Ø·Ø§Ø±Ø®")
        if product:
            return f"ğŸ“Œ {product['kw'][0]} Ù…ØªØ§Ø­ ÙŠØ§ ÙÙ†Ø¯Ù…. ØªØ­Ø¨ ØªØ¹Ø±Ù Ø§Ù„Ø³Ø¹Ø±ØŸ"

        # 7. Ø§Ù„Ø±Ø¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (Fallback) Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØµÙ…Øª
        return "Ù†ÙˆØ±ØªÙ†Ø§ ÙÙŠ Ø±Ù†Ø¬Ø© Ø£Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯ ğŸ‘‹.. Ù…Ù…ÙƒÙ† ØªÙˆØ¶Ø­ Ø³Ø¤Ø§Ù„Ùƒ Ø£ÙƒØªØ±ØŸ Ø­Ø§Ø¨Ø¨ ØªØ¹Ø±Ù (Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŒ Ø§Ù„Ù…Ù†ÙŠÙˆØŒ Ø£Ù…Ø§ÙƒÙ† Ø§Ù„ÙØ±ÙˆØ¹)ØŸ âœ¨"

    except Exception as e:
        print(f"Error in get_answer: {e}")
        return "Ù†ÙˆØ±ØªÙ†Ø§ ÙŠØ§ ÙÙ†Ø¯Ù…ØŒ Ø§Ø¤Ù…Ø±Ù†Ø§ Ù…Ø­ØªØ§Ø¬ ØªØ³Ø£Ù„ Ø¹Ù† Ø¥ÙŠÙ‡ØŸ âœ¨"
          # ================== WEBHOOK ==================
@app.route("/webhook", methods=["GET"])
def verify():
    if request.args.get("hub.verify_token") == VERIFY_TOKEN:
        return request.args.get("hub.challenge")
    return "failed", 403

@app.route("/webhook", methods=["POST"])
def webhook():
    data = request.get_json()
    if data.get("object") == "page":
        for entry in data.get("entry", []):
            for ev in entry.get("messaging", []):
                sender = ev["sender"]["id"]
                if "message" in ev and "text" in ev["message"]:
                    reply = get_answer(sender, ev["message"]["text"])
                    send_message(sender, reply)
    return "ok", 200

def send_message(user_id, text):
    url = f"https://graph.facebook.com/v12.0/me/messages?access_token={PAGE_ACCESS_TOKEN}"
    payload = {"recipient": {"id": user_id}, "message": {"text": text}}
    requests.post(url, json=payload)

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=int(os.environ.get("PORT", 8080)))





