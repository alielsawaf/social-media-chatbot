from flask import Flask, request, jsonify
import os
import requests
from fuzzywuzzy import fuzz

app = Flask(__name__)

# --- 1. Ù‚Ø±Ø§Ø¡Ø© Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© Ù…Ù† Railway ---
VERIFY_TOKEN = os.environ.get('VERIFY_TOKEN')
PAGE_ACCESS_TOKEN = os.environ.get('PAGE_ACCESS_TOKEN')

# --- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªÙŠ Ø³ÙŠØªÙ… Ø¥Ø²Ø§Ù„ØªÙ‡Ø§ (Stop Words) Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù†Øµ (ØªÙ†Ù‚ÙŠØ© ÙØ§Ø¦Ù‚Ø©) ---
STOP_WORDS = [
    'Ù…Ù…ÙƒÙ†', 'Ù„Ùˆ', 'Ø³Ù…Ø­Øª', 'ÙŠØ§', 'ÙÙ†Ø¯Ù…', 'Ø¹Ø§ÙŠØ²', 'Ù…Ù†', 'ÙØ¶Ù„Ùƒ', 'Ø·ÙŠØ¨', 'Ø§ÙŠÙ‡', 'Ù‡Ùˆ', 'Ù‡ÙŠ', 
    'ÙÙŠÙ†', 'Ø§Ø²Ø§ÙŠ', 'ØªÙƒÙˆÙ†', 'Ø¨ØªØ§Ø¹ØªÙƒÙˆ', 'Ø¨ØªØ§Ø¹ØªÙ†Ø§', 'Ø¨ØªØ§Ø¹ØªÙƒÙˆØ§', 'Ø¨ØªØ§Ø¹ØªÙŠ', 'Ù…ØªØ§Ø­', 'Ù‡Ù„', 
    'Ø¨ÙƒØ§Ù…', 'Ø§Ù„ÙØ±Ù‚', 'Ø¨ÙŠÙ†', 'Ùˆ', 'Ø¯ÙŠ', 'Ø¯Ø§', 'Ø¯Ù‡', 'Ø§Ù„ÙŠ', 'Ø§Ù„Ù„ÙŠ', 'Ø§Ù†', 'Ø£Ù†', 'Ù„ÙŠÙ‡', 'Ø¹Ø´Ø§Ù†',
    'Ø­Ø¶Ø±ØªÙƒ', 'Ø±Ù‚Ù…', 'ÙŠØ±Ø¬Ù‰', 'Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±', 'Ø§Ø±ÙŠØ¯', 'ØªÙˆØ§ØµÙ„', 'Ø¹Ù†ÙˆØ§Ù†', 'Ø§Ø¨ÙŠ', 'ÙƒØ§Ù…', 'Ø¹Ù†', 
    'Ù„ÙˆÙŠÙ†', 'Ù…ØªÙˆÙØ±', 'Ø´ÙƒØ±Ø§', 'ØµØ¨Ø§Ø­', 'Ù…Ø³Ø§Ø¡', 'Ø§Ù„Ø®ÙŠØ±', 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±', 'ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±', 'Ø§Ù‡Ù„Ø§',
    'Ø§Ù†Ø§', 'Ø§Ø­Ù†Ø§', 'ÙƒÙ„', 'Ø¯Ù„ÙˆÙ‚ØªÙŠ', 'Ø¹Ù„Ø´Ø§Ù†', 'Ù…ÙÙŠØ´', 'ÙŠÙˆÙ…', 'Ø§Ø®Ø±', 'Ø¬Ø¯ÙŠØ¯', 'ØµÙˆØ±Ø©', 'Ø¹Ù„ÙŠ',
    'ÙÙŠ', 'Ø§Ù„Ù‰', 'Ø§ÙˆÙ‚Ø§Øª', 'Ø§Ø°Ø§', 'ÙƒÙ†Øª', 'Ø§Ø³Ø£Ù„', 'Ø¨Ø®ØµÙˆØµ' # Ø¥Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ù†Ù‚Ø§Ø¡
]

def clean_text(text):
    """Ø¥Ø²Ø§Ù„Ø© Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ±Ù‚ÙŠÙ… ÙˆØ§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ­Ø¯Ø¯ Ø§Ù„Ù†ÙŠØ© (Stop Words)."""
    # 1. Ø¥Ø²Ø§Ù„Ø© Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ±Ù‚ÙŠÙ… ÙˆØ§Ù„Ø±Ù…ÙˆØ²
    cleaned_text = ''.join(c for c in text if c.isalnum() or c.isspace())
    
    # 2. ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù†Øµ Ø¥Ù„Ù‰ Ù‚Ø§Ø¦Ù…Ø© ÙƒÙ„Ù…Ø§Øª
    words = cleaned_text.lower().split()
    
    # 3. Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªÙŠ Ù„Ø§ ØªØ­Ø¯Ø¯ Ø§Ù„Ù†ÙŠØ© (Stop Words)
    meaningful_words = [word for word in words if word not in STOP_WORDS]
    
    # 4. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
    return " ".join(meaningful_words)


# --- Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø·ÙˆÙŠÙ„Ø© (Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø´Ø§Ù…Ù„Ø©) ---

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 1: Ø§Ù„ØªÙˆØµÙŠÙ„
ANSWER_DELIVERY = "Ø®Ø¯Ù…Ø© Ø§Ù„ØªÙˆØµÙŠÙ„...\nØ§Ù„Ù‚Ø§Ù‡Ø±Ù‡: Ø®Ø¯Ù…Ø© ØªÙˆØµÙŠÙ„ Ø£Ø¨Ùˆ Ø§Ù„Ø³ÙŠØ¯ Ù…ØªØ§Ø­Ø© Ø§Ù„Ø¢Ù† ÙÙŠ Ù…Ø¯ÙŠÙ†ØªÙŠ Ø§Ø±Ø¨ÙŠØ³Ùƒ ÙˆØ§Ù„ØªØ¬Ù…Ø¹ Ø§Ù„Ø£ÙˆÙ„ ÙˆØ§Ù„Ø®Ø§Ù…Ø³ ÙˆØ§Ù„Ø«Ø§Ù„Ø« ÙˆÙˆÙŠØ³Øª Ø¬ÙŠØª Ø£ÙƒØªÙˆØ¨Ø± ÙÙ‚Ø·.\nÙ„Ù„Ø·Ù„Ø¨Ø§Øª Ø®Ø§Ø±Ø¬ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ØŒ Ù†ÙˆÙØ± Ù„Ùƒ Ø³Ø§Ø¦Ù‚Ù‹Ø§ Ø®Ø§ØµÙ‹Ø§ Ù„ÙƒÙ† Ø¨Ø±Ø³ÙˆÙ… ØªÙˆØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©.\nØ®Ø¯Ù…Ù‡ Ø§Ù„ØªÙˆØµÙŠÙ„ Ù…ØªÙˆÙØ±Ù‡ ÙÙ‰ Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯ Ùˆ Ø§Ù„Ù‚Ø§Ù‡Ø±Ù‡ Ùˆ Ø§Ø³ÙƒÙ†Ø¯Ø±ÙŠÙ‡ ÙˆØ§Ù„ØºØ±Ø¯Ù‚Ù‡ ÙÙ‚Ø·. Ù„Ù„Ø·Ù„Ø¨ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¹Ù„Ù‰ 01212166660."

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 2: Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø£ØµØ§Ù„Ø© ÙˆØ§Ù„Ù…Ù†Ø´Ø£ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø­Ø§ÙØ¸Ø© (Ù…ÙØ¬Ù…Ù‘ÙØ¹ ÙˆØ´Ø§Ù…Ù„)
ANSWER_QUALITY_ORIGIN = """
Ù†Ø¶Ù…Ù† Ù„Ùƒ Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ø¹Ø§Ù„ÙŠØ©Ø› Ø­ÙŠØ« Ù†Ø¹ØªÙ…Ø¯ Ø¹Ù„Ù‰:
1.  **Ø§Ù„ØªÙ…Ù„ÙŠØ­ ÙˆØ§Ù„ØªØ¯Ø®ÙŠÙ†:** ØªÙ…Ù„ÙŠØ­ Ø³Ù…Ùƒ Ø§Ù„Ø±Ù†Ø¬Ø© Ø¨Ù…Ø­Ù„ÙˆÙ„ Ø¨Ø±Ø§ÙŠÙ† ÙˆØ§Ù„ØªØ¯Ø®ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø¨Ø§Ø±Ø¯ Ø¨Ù†Ø´Ø§Ø±Ø© Ø£Ù„Ù…Ø§Ù†ÙŠ Ù„Ù…Ù†ØªØ¬ ØµØ­ÙŠ.
2.  **Ø§Ù„Ù…Ù†Ø´Ø£:** Ø§Ù„Ø±Ù†Ø¬Ø© ÙˆØ§Ù„Ù…Ø§ÙƒØ±ÙŠÙ„ Ù…Ù† **Ù‡ÙˆÙ„Ù†Ø¯Ø§/Ø§Ù„Ù†Ø±ÙˆÙŠØ¬/Ø¬Ø²Ø± Ø§Ù„ÙØ§Ø±Ùˆ**ØŒ ÙˆØ§Ù„ÙØ³ÙŠØ® (Ø§Ù„Ø¨ÙˆØ±ÙŠ) Ù…Ù† **Ø§Ù„ÙŠØ§Ø¨Ø§Ù†**.
3.  **Ø®Ø§Ù„ÙŠØ© Ù…Ù† Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø­Ø§ÙØ¸Ø©:** Ø¬Ù…ÙŠØ¹ Ù…Ù†ØªØ¬Ø§ØªÙ†Ø§ Ø®Ø§Ù„ÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹ Ù…Ù† Ø£ÙŠ Ù…ÙˆØ§Ø¯ Ø­Ø§ÙØ¸Ø©.
4.  **Ø§Ù„Ø£ØµØ§Ù„Ø©:** Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© ØªÙƒÙˆÙ† ÙÙŠ **ÙƒØ±Ø§ØªÙŠÙ†** ÙˆÙ„ÙŠØ³Øª ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø®Ø´Ø¨.
"""

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 3: Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ§Ø­Ø© (Ù…ÙØ¬Ù…Ù‘ÙØ¹)
ANSWER_NOT_AVAILABLE_PRODUCTS = "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ ÙˆÙ‡ÙŠ:\n1. Ù…Ù†ÙŠÙˆ Ø§Ù„Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª ÙˆØ§Ù„Ø³Ù„Ø·Ø§Øª (Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙˆØµÙŠÙ„ Ø£Ùˆ ØµØ§Ù„Ø© Ù„Ù„Ø£ÙƒÙ„).\n2. Ø±Ù†Ø¬Ø© ÙÙŠÙ„ÙŠÙ‡ Ø¨ØµÙˆØµ Ø§Ù„Ø³ÙƒØ±.\n3. ÙØ³ÙŠØ® ÙÙŠÙ„ÙŠÙ‡ ÙØ§ÙƒÙŠÙˆÙ… (ØºÙŠØ± Ù…ØªØ§Ø­ ÙÙŠ Ø§Ù„ÙØ±ÙˆØ¹ Ø£Ùˆ Ø§Ù„Ø¬Ù…Ù„Ø©)."

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 4: Ø§Ù„Ù…Ù†ÙŠÙˆ (Ø§Ù„Ù„ÙŠÙ†Ùƒ)
ANSWER_MENU = "Ø¯Ø§ Ù„ÙŠÙ†Ùƒ Ù…Ù†ÙŠÙˆ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨ØªØ§Ø¹ØªÙ†Ø§:\nhttps://heyzine.com/flip-book/31946f16d5.html"

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 5: Ø§Ù„ØªÙˆÙ†Ø© (Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ù„ÙˆÙ†)
ANSWER_TUNA_DETAILS = "Ø§Ù„ØªÙˆÙ†Ø© Ù‡ÙŠ Ù…Ù† Ù†ÙˆØ¹ **ÙŠÙ„ÙˆÙÙŠÙ† (Yellowfin Tuna)**ØŒ Ù…ØµØ±ÙŠØ©ØŒ ÙˆÙŠØªÙ… Ø§ØµØ·ÙŠØ§Ø¯Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¨Ø­Ø± Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„Ù…ØªÙˆØ³Ø·. Ø§Ù„Ù„Ø­Ù… Ø§Ù„Ø£Ø­Ù…Ø± Ø£Ø¹Ù„Ù‰ ÙÙŠ Ù†Ø³Ø¨Ø© Ø§Ù„Ø¨Ø±ÙˆØªÙŠÙ† ÙˆØ£ÙƒØ«Ø± Ø·Ø±Ø§ÙˆØ© Ù…Ù† Ø§Ù„Ø£Ø¨ÙŠØ¶. Ø§Ù„ØªÙˆÙ†Ø© Ø§Ù„Ù…Ø¹Ù„Ø¨Ø© Ø§Ù„ØªÙŠ Ù†Ø¨ÙŠØ¹Ù‡Ø§ Ù„ÙŠØ³Øª Ù…Ø³ØªÙˆØ±Ø¯Ø©."

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 6: Ø§Ù„Ø³Ù„Ù…ÙˆÙ†
ANSWER_SALMON_DIFF = "Ø§Ù„ÙØ±Ù‚ Ø¨ÙŠÙ† Ø§Ù„Ø³Ù„Ù…ÙˆÙ† (Ø·Ø¨Ù‚/ÙƒÙŠØ³) Ø¨ÙŠÙƒÙˆÙ† ÙÙŠ Ù„ÙˆÙ† Ø§Ù„Ù„Ø­Ù…ØŒ Ø­ÙŠØ« ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø·Ø¨Ù‚ Ø£ÙØªØ­ Ø¨Ø³Ø¨Ø¨ Ø§Ø®ØªÙ„Ø§Ù Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ¯Ø®ÙŠÙ† ÙˆØ§Ù„ØªÙ…Ù„ÙŠØ­ ÙˆØ§Ù„Ø·Ù‡ÙŠØŒ Ù…Ù…Ø§ ÙŠØ¤Ø¯ÙŠ Ù„Ø§Ø®ØªÙ„Ø§Ù Ø¨Ø³ÙŠØ· ÙÙŠ Ø§Ù„Ø·Ø¹Ù…."

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 7: Ø§Ù„Ø±Ù†Ø¬Ø© (ÙÙŠÙ„ÙŠÙ‡ ÙˆÙ†Ø§Ø´ÙØ© ÙˆØ¹ÙŠØ§Ø± 24)
ANSWER_HERRING_DETAILS = "Ø±Ù†Ø¬Ø© **Ø§Ù„ÙÙŠÙ„ÙŠÙ‡** Ù…Ø®Ù„ÙŠØ© ÙˆØªØ£Ø®Ø° 3 Ø·Ø¨Ù‚Ø§Øª ØªØ¯Ø®ÙŠÙ† Ù„ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø·Ø¹Ù…ØŒ Ù„Ø°Ù„Ùƒ ØªÙƒÙˆÙ† **Ø£Ù†Ø´Ù** Ù…Ù† Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©. Ø±Ù†Ø¬Ø© **Ø¹ÙŠØ§Ø± 24** ØªÙƒÙˆÙ† Ø­Ø¬Ù… Ø³Ù…ÙƒØªÙ‡Ø§ Ø£ØµØºØ± ÙˆØ¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª ØªØ¯Ø®ÙŠÙ†Ù‡Ø§ Ø£Ø·ÙˆÙ„ Ù„ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø·Ø¹Ù…."

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 8: Ø§Ù„ÙØ³ÙŠØ® (Ø¯Ù… ÙˆØ­ÙØ¸ ÙˆÙ…Ù†Ø´Ø£)
ANSWER_FESIKH_DETAILS = "ÙŠØªÙ… Ø¹Ù…Ù„ Ø§Ù„ÙØ³ÙŠØ® Ù…Ù† Ø³Ù…Ùƒ **Ø§Ù„Ø¨ÙˆØ±ÙŠ** (Ù…Ù†Ø´Ø£Ù‡ **Ø§Ù„ÙŠØ§Ø¨Ø§Ù†**)ØŒ ÙˆÙŠÙ…Ù„Ø­ ØªÙ…Ù„ÙŠØ­ Ø¬Ø§Ù ÙØ±ÙŠØ´. **Ø§Ù„Ø¯Ù…** Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± Ø³Ø¨Ø¨Ù‡ Ø®Ø±ÙˆØ¬ Ø§Ù„Ø³Ù…ÙƒØ© Ù…Ù† Ø§Ù„ØªØ¬Ù…ÙŠØ¯ØŒ ÙˆÙ‡ÙŠ Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø£ÙƒÙ„. ÙŠØ­ÙØ¸ Ø¯Ø§Ø®Ù„ Ø«Ù„Ø§Ø¬Ø§Øª 0-4Â°C."

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 9: Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ©
ANSWER_STORAGE_FROZEN_FRESH = "Ø§Ù„Ø±Ù†Ø¬Ù‡ **Ø§Ù„Ù…Ø¬Ù…Ø¯Ù‡**: ØªØ­ÙØ¸ ÙÙŠ -18Â°CØŒ ØµÙ„Ø§Ø­ÙŠÙ‡ 3 Ø´Ù‡ÙˆØ±. Ø§Ù„Ø±Ù†Ø¬Ù‡ **Ø§Ù„ÙØ±ÙŠØ´**: ØªØ­ÙØ¸ ÙÙŠ 0-4Â°CØŒ ØµÙ„Ø§Ø­ÙŠÙ‡ Ø´Ù‡Ø±. ÙŠÙØ¶Ù„ Ø­ÙØ¸Ù‡Ø§ ÙÙŠ Ø§Ù„ÙØ±ÙŠØ²Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡."

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 10: Ø§Ù„Ø¨Ø·Ø±ÙˆØ® ÙˆØ§Ù„Ù…Ù„ÙˆØ­Ø©
ANSWER_ROE_SALTINESS = "Ø§Ù„Ø±Ù†Ø¬Ø© Ø§Ù„Ù…Ø¨Ø·Ø±Ø®Ø© ÙŠØªÙˆÙØ± Ù…Ù†Ù‡Ø§ Ù†ÙˆØ¹ÙŠÙ†: 1. Ø¨Ø·Ø±ÙˆØ® **Ù†Ø§Ø´Ù Ø£Ùˆ Ù…Ø±Ù…Ù„ (Ø®Ø±Ø²)**. 2. Ø¨Ø·Ø±ÙˆØ® **Ø·Ø±ÙŠ (Ø¯Ù‡Ù†)**. Ø£Ù…Ø§ Ù†Ø³Ø¨Ø© **Ø§Ù„Ù…Ù„ÙˆØ­Ø©** ÙØªÙƒÙˆÙ† Ù…Ø¶Ø¨ÙˆØ·Ø© ÙˆÙ…Ø¹ØªØ¯Ù„Ø©ØŒ ÙˆØªØ®ØªÙ„Ù ÙÙŠ ØªÙ‚Ø¨Ù„Ù‡Ø§ Ù…Ù† Ø´Ø®Øµ Ù„Ø¢Ø®Ø±."

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 11: Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ (Ø·ÙÙŠÙ„ÙŠØ§Øª/Ø¯ÙˆØ¯) (Ø§Ù„Ø±Ø¯ Ø§Ù„Ù†Ù‚Ø¯ÙŠ)
ANSWER_COMPLAINT_START = """
Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ± ÙŠØ§ ÙÙ†Ø¯Ù…. Ù†Ø¹ØªØ°Ø± Ø¹Ù† Ø£ÙŠ Ø¥Ø²Ø¹Ø§Ø¬!
Ø§Ù„Ø³Ù…ÙƒØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ **Ø·ÙÙŠÙ„ÙŠØ§Øª** (ÙˆÙ„ÙŠØ³Øª Ø¯ÙˆØ¯ Ø­ÙŠ) ÙÙŠ Ø§Ù„ØªØ¬ÙˆÙŠÙ Ø§Ù„Ø¨Ø·Ù†ÙŠ. Ø§Ù„Ø·ÙÙŠÙ„ÙŠØ§Øª Ù„Ø§ ØªØ¶Ø± ÙˆØªØµØ¨Ø­ Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ù…Ø¹Ø§Ø¡ Ø¨Ø§Ù„ØªØ¬Ù…ÙŠØ¯ Ø¹Ù„Ù‰ -35Â°C.
âš ï¸ **Ø§Ù„Ø¯ÙˆØ¯ Ø§Ù„Ø­ÙŠ** Ù„Ø§ ÙŠØ¸Ù‡Ø± Ø¥Ù„Ø§ ÙÙŠ Ø³Ù…ÙƒØ© Ù…Ù†ØªÙØ®Ø© Ø£Ùˆ Ù…ØªØ¹ÙÙ†Ø© Ø£Ùˆ Ù…ØªÙ‡ØªÙƒØ© (ÙˆÙ‡Ø°Ø§ Ù„Ø§ ÙŠØ­Ø¯Ø« Ù„Ø¯ÙŠÙ†Ø§).
Ù„Ù…Ø±Ø§Ø¬Ø¹Ø© ØªÙ‚Ø±ÙŠØ± Ù‡ÙŠØ¦Ø© Ø³Ù„Ø§Ù…Ø© Ø§Ù„ØºØ°Ø§Ø¡: [ØªÙ‚Ø±ÙŠØ± Ù‡ÙŠØ¦Ø© Ø³Ù„Ø§Ù…Ø© Ø§Ù„ØºØ°Ø§Ø¡](https://drive.google.com/file/d/1TMfHL964lcaMxap6H5XruiV9Z3kcIiYX/view?usp=drive_link)
Ù„ÙØªØ­ Ø¨Ù„Ø§Øº Ø±Ø³Ù…ÙŠ (Ø§Ø³Ù…ØŒ Ø±Ù‚Ù…ØŒ ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬ ÙˆØ§Ù„Ø±ÙŠØ³ÙŠØªØŒ Ø§Ù„ÙØ±Ø¹) ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡: **01212166660**
"""

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 12: ÙØ±ÙˆØ¹ ÙˆÙ…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„
ANSWER_BRANCHES = """
Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙØ±ÙˆØ¹ Ù‡ÙŠ Ù…Ù† 10 ØµØ¨Ø§Ø­Ø§Ù‹ Ø­ØªÙ‰ 12 Ù…Ù†ØªØµÙ Ø§Ù„Ù„ÙŠÙ„.
ğŸ“ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„ÙØ±ÙˆØ¹ ØªØ´Ù…Ù„:
1.  **Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯:** Ù…ÙˆÙ„ Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯ Ø³ØªØ§Ø±ØŒ Ø³ÙˆÙ‚ Ø§Ù„Ø³Ù…Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ØŒ Ù…Ù†ÙØ° Ø¨ÙŠØ¹ Ø§Ù„Ù…ØµÙ†Ø¹.
2.  **Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©:** Ø³Ø¨ÙŠÙ†ÙŠØ³ (Ù…ÙˆÙ„ Ø§Ù„Ø¹Ø±Ø¨ØŒ Ù…Ø²Ø§Ø±)ØŒ Ø¨Ù†Ø¯Ù‡ØŒ Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„ÙØ§Ø± (Ø§Ù„ØªØ¬Ù…Ø¹ØŒ Ù…Ø¯ÙŠÙ†ØªÙŠ)ØŒ ÙƒØ§Ø±ÙÙˆØ±ØŒ Ù„ÙˆÙ„Ùˆ Ù…Ø§Ø±ÙƒØª.
3.  **Ø§Ù„Ø¥Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©:** Ø³Ù…ÙˆØ­Ø©ØŒ Ø¬Ø±ÙŠÙ† ØªØ§ÙˆØ±Ø²ØŒ Ø¬ÙŠ Ù…ÙˆÙ„.
(Ø¥Ø°Ø§ Ù„Ù… ØªØ¬Ø¯ ÙØ±Ø¹Ø§Ù‹ Ù…Ø­Ø¯Ø¯Ø§Ù‹ ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©ØŒ ÙÙ‡Ùˆ ØºÙŠØ± Ù…ØªØ§Ø­ Ø­Ø§Ù„ÙŠØ§Ù‹).
"""

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© 13: Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…ØªØ®ØµØµ (Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ø¬Ù…Ø¹Ø©)
ANSWER_CONTACTS = """
Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…ØªØ®ØµØµØ©:
-   **Ø§Ù„Ø¯Ù„ÙŠÙØ±ÙŠ / Ø§Ù„Ø£ÙˆØ±Ø¯Ø±Ø§Øª:** 01212166660
-   **Ø·Ù„Ø¨Ø§Øª ÙˆØ§Ø³ØªÙØ³Ø§Ø±Ø§Øª Ø§Ù„Ø¬Ù…Ù„Ø©/Ø§Ù„ØªÙˆØ±ÙŠØ¯:** 01211113882
-   **Ù…Ø¯ÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø¬Ù…Ù„Ø©:** 01221093951
-   **Ø§Ù„ØªÙˆØ¸ÙŠÙ (Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©):** 01280709999
-   **Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª:** 01202888891
-   **Ù…Ø³Ø¤ÙˆÙ„ Ø§Ù„ØªØµØ¯ÙŠØ± (Ø£/Ø£Ø­Ù…Ø¯ Ø§Ù„Ø£Ù„ÙÙŠ):** 01272475555
(ÙÙŠ Ø­Ø§Ù„ Ø¹Ø¯Ù… Ø§Ù„Ø±Ø¯ Ù…Ù† Ø§Ù„ÙØ±ÙˆØ¹ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø£Ùˆ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¯Ù„ÙŠÙØ±ÙŠ Ø§Ù„Ø¹Ø§Ù….)
"""


# --- 2. Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª (FAQ) Ø§Ù„Ù…Ø­Ø¯Ø«Ø© Ø¨Ø§Ù„Ù…Ø±Ø§Ø¯ÙØ§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø© ---
FAQ = {
    # ------------------ 1. Ø§Ù„ØªÙˆØµÙŠÙ„ ÙˆØ§Ù„Ø´Ø­Ù† Ùˆ Ø§Ù„Ø£ÙˆØ±Ø¯Ø± ------------------
    "ØªÙˆØµÙŠÙ„": ANSWER_DELIVERY, "Ø¯Ù„ÙŠÙØ±ÙŠ": ANSWER_DELIVERY, "Ø´Ø­Ù†": ANSWER_DELIVERY,
    "Ù…Ù†Ø§Ø·Ù‚ ØªÙˆØµÙŠÙ„": ANSWER_DELIVERY, "Ø·Ù„Ø¨ Ø§ÙˆØ±Ø¯Ø±": ANSWER_DELIVERY, "Ø±Ù‚Ù… Ø§Ù„Ø¯Ù„ÙŠÙØ±ÙŠ": ANSWER_DELIVERY,
    "Ø§ÙˆÙ†Ù„Ø§ÙŠÙ†": ANSWER_DELIVERY, "ÙˆØ²Ù† ÙƒØ±ØªÙˆÙ†Ø©": ANSWER_DELIVERY, 
    
    # ------------------ 2. Ø§Ù„Ø´ÙƒØ§ÙˆÙ‰ ÙˆØ§Ù„Ø¯ÙˆØ¯/Ø§Ù„Ø·ÙÙŠÙ„ÙŠØ§Øª (Ù…ÙØ§ØªÙŠØ­ Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø£Ù‡Ù…ÙŠØ©) ------------------
    "Ø´ÙƒÙˆÙ‰": ANSWER_COMPLAINT_START, "Ø¯ÙˆØ¯": ANSWER_COMPLAINT_START,
    "Ø·ÙÙŠÙ„ÙŠØ§Øª": ANSWER_COMPLAINT_START, "ÙØ§Ø³Ø¯": ANSWER_COMPLAINT_START, "Ù…ØªØ¹ÙÙ†": ANSWER_COMPLAINT_START,
    "ØµØ­Ø©": ANSWER_COMPLAINT_START, "Ø³Ù„Ø§Ù…Ø© Ø§Ù„ØºØ°Ø§Ø¡": ANSWER_COMPLAINT_START,

    # ------------------ 3. Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø£ØµØ§Ù„Ø© ÙˆØ§Ù„Ù…Ù†Ø´Ø£ ÙˆØ§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø­Ø§ÙØ¸Ø© ------------------
    "Ø¬ÙˆØ¯Ø©": ANSWER_QUALITY_ORIGIN, "Ø§ØµÙ„ÙŠ": ANSWER_QUALITY_ORIGIN, "ØªÙ‚Ù„ÙŠØ¯": ANSWER_QUALITY_ORIGIN, 
    "ÙƒØ±Ø§ØªÙŠÙ†": ANSWER_QUALITY_ORIGIN, "Ù…ÙˆØ§Ø¯ Ø­Ø§ÙØ¸Ø©": ANSWER_QUALITY_ORIGIN, "Ù‡ÙˆÙ„Ù†Ø¯Ø§": ANSWER_QUALITY_ORIGIN, 
    "Ù†Ø±ÙˆÙŠØ¬": ANSWER_QUALITY_ORIGIN, "Ù…Ù†Ø´Ø£": ANSWER_QUALITY_ORIGIN, "ØªØ¯Ø®ÙŠÙ†": ANSWER_QUALITY_ORIGIN,
    "ØºØ§Ù„ÙŠÙ‡": ANSWER_QUALITY_ORIGIN, "Ø³Ø¹Ø±": ANSWER_QUALITY_ORIGIN,
    
    # ------------------ 4. Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ù…ØªØ®ØµØµ (Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ø§ØªÙ) ------------------
    "Ø§Ø±Ù‚Ø§Ù… ØªÙ„ÙŠÙÙˆÙ†Ø§Øª": ANSWER_CONTACTS, "Ø§Ø±Ù‚Ø§Ù… Ø§Ù„ØªÙˆØ§ØµÙ„": ANSWER_CONTACTS, 
    "ØªÙˆØ±ÙŠØ¯ Ø¬Ù…Ù„Ø©": ANSWER_CONTACTS, "Ù…Ø¯ÙŠØ± Ù…Ø¨ÙŠØ¹Ø§Øª Ø¬Ù…Ù„Ø©": ANSWER_CONTACTS, "ØªÙˆØ¸ÙŠÙ": ANSWER_CONTACTS,
    "Ù…Ø´ØªØ±ÙŠØ§Øª": ANSWER_CONTACTS, "ØªØµØ¯ÙŠØ±": ANSWER_CONTACTS, "Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø´Ø±ÙŠØ©": ANSWER_CONTACTS,
    "Ø¹Ø¯Ù… Ø§Ù„Ø±Ø¯ ÙØ±ÙˆØ¹": ANSWER_CONTACTS,

    # ------------------ 5. ÙØ±ÙˆØ¹ ÙˆÙ…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„ ------------------
    "Ø¹Ù†Ø§ÙˆÙŠÙ† ÙØ±ÙˆØ¹": ANSWER_BRANCHES, "Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ø¨ÙŠØ¹": ANSWER_BRANCHES, "Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„": ANSWER_BRANCHES,
    "Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯": ANSWER_BRANCHES, "Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©": ANSWER_BRANCHES, "Ø§Ø³ÙƒÙ†Ø¯Ø±ÙŠØ©": ANSWER_BRANCHES,

    # ------------------ 6. Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ØºÙŠØ± Ø§Ù„Ù…ØªØ§Ø­Ø© (Ù…ÙØ¬Ù…Ù‘ÙØ¹) ------------------
    "Ø³Ø§Ù†Ø¯ÙˆØªØ´Ø§Øª": ANSWER_NOT_AVAILABLE_PRODUCTS, "Ø³Ù„Ø·Ø©": ANSWER_NOT_AVAILABLE_PRODUCTS, 
    "ÙÙŠÙ„ÙŠÙ‡ Ø³ÙƒØ±": ANSWER_NOT_AVAILABLE_PRODUCTS, "ÙØ³ÙŠØ® ÙÙŠÙ„ÙŠÙ‡ ÙØ§ÙƒÙŠÙˆÙ…": ANSWER_NOT_AVAILABLE_PRODUCTS,
    
    # ------------------ 7. Ø§Ù„Ø±Ù†Ø¬Ø© (ÙÙŠÙ„ÙŠÙ‡ ÙˆÙ†Ø§Ø´ÙØ© ÙˆØ¹ÙŠØ§Ø± 24) ------------------
    "Ø±Ù†Ø¬Ø© ÙÙŠÙ„ÙŠÙ‡": ANSWER_HERRING_DETAILS, "Ù†Ø§Ø´ÙØ©": ANSWER_HERRING_DETAILS, "Ø¹ÙŠØ§Ø± 24": ANSWER_HERRING_DETAILS,

    # ------------------ 8. Ø§Ù„ÙØ³ÙŠØ® (Ø¯Ù… ÙˆØ­ÙØ¸ ÙˆÙ…Ù†Ø´Ø£) ------------------
    "Ø§Ù„ÙØ³ÙŠØ® Ø¯Ù…": ANSWER_FESIKH_DETAILS, "ÙØ³ÙŠØ®": ANSWER_FESIKH_DETAILS, "Ø¨ÙˆØ±ÙŠ": ANSWER_FESIKH_DETAILS, 
    "ÙŠØ§Ø¨Ø§Ù†ÙŠ": ANSWER_FESIKH_DETAILS,

    # ------------------ 9. Ø§Ù„ØªÙˆÙ†Ø© (Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ù„ÙˆÙ†) ------------------
    "Ù†ÙˆØ¹ Ø§Ù„ØªÙˆÙ†Ø©": ANSWER_TUNA_DETAILS, "ÙŠÙ„ÙˆÙÙŠÙ†": ANSWER_TUNA_DETAILS, "Ù„Ø­Ù… Ø§Ø­Ù…Ø±": ANSWER_TUNA_DETAILS,
    "Ù„Ø­Ù… Ø§Ø¨ÙŠØ¶": ANSWER_TUNA_DETAILS, "ØªÙˆÙ†Ø© Ù…Ø³ØªÙˆØ±Ø¯Ø©": ANSWER_TUNA_DETAILS,
    
    # ------------------ 10. Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ© ------------------
    "Ø­ÙØ¸ Ø§Ù„Ø±Ù†Ø¬Ø©": ANSWER_STORAGE_FROZEN_FRESH, "ØªØ®Ø²ÙŠÙ†": ANSWER_STORAGE_FROZEN_FRESH, "ØµÙ„Ø§Ø­ÙŠØ©": ANSWER_STORAGE_FROZEN_FRESH,
    "Ù…Ø¬Ù…Ø¯Ø©": ANSWER_STORAGE_FROZEN_FRESH, "ÙØ±ÙŠØ´": ANSWER_STORAGE_FROZEN_FRESH, "Ø¯Ø±Ø¬Ø© Ø­Ø±Ø§Ø±Ø©": ANSWER_STORAGE_FROZEN_FRESH,

    # ------------------ 11. Ø§Ù„Ø¨Ø·Ø±ÙˆØ® ÙˆØ§Ù„Ù…Ù„ÙˆØ­Ø© ------------------
    "Ø¨Ø·Ø±ÙˆØ®": ANSWER_ROE_SALTINESS, "Ù…Ø±Ù…Ù„": ANSWER_ROE_SALTINESS, "Ø®Ø±Ø²": ANSWER_ROE_SALTINESS,
    "Ø¯Ù‡Ù†ÙŠ": ANSWER_ROE_SALTINESS, "Ø·Ø±ÙŠ": ANSWER_ROE_SALTINESS, "Ù…Ù„ÙˆØ­Ø©": ANSWER_ROE_SALTINESS,

    # ------------------ 12. Ù…ØªÙØ±Ù‚Ø§Øª ------------------
    "Ø³Ù„Ù…ÙˆÙ†": ANSWER_SALMON_DIFF, "Ù…Ù†ÙŠÙˆ": ANSWER_MENU, "ÙƒØªØ§Ù„ÙˆØ¬": ANSWER_MENU,
}


# --- 3. Ø¯Ø§Ù„Ø© Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© (ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£ÙˆØ²Ø§Ù† ÙˆØ§Ù„Ø¹ØªØ¨Ø©) ---
def get_answer(cleaned_message):
    """ØªØ³ØªØ®Ø¯Ù… ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ÙŠØ© Ø§Ù„Ù…Ø±Ø¬Ø­Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ø£Ù†Ø³Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØ·Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ø¬Ø²Ø¦ÙŠØ© (ØªÙ… ØªØ¹Ø²ÙŠØ² Ø§Ù„Ø£ÙˆØ²Ø§Ù†)."""
    
    cleaned_message_lower = cleaned_message.lower()
    
    # Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ÙØ±ÙŠØ¯Ø© ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù†Ø¸ÙŠÙ
    query_words = set(cleaned_message_lower.split())
    
    best_match_answer = None
    max_score = 0
    
    # Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (ØªÙ… Ø®ÙØ¶Ù‡ Ù„Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©)
    SCORE_THRESHOLD = 75 
    
    for question_key, answer in FAQ.items():
        # ØªÙ‚Ø³ÙŠÙ… Ù…ÙØªØ§Ø­ Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ø¥Ù„Ù‰ ÙƒÙ„Ù…Ø§Øª ÙØ±ÙŠØ¯Ø©
        key_words = set(question_key.lower().split())
        
        # 1. Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„ØªØ´Ø§Ø¨Ù‡ (Fuzzy Ratio) ÙƒØ¹Ø§Ù…Ù„ Ø£Ø³Ø§Ø³ÙŠ
        ratio_score = fuzz.token_set_ratio(cleaned_message_lower, question_key.lower())
        
        # 2. Ø¹Ø§Ù…Ù„ Ù‚ÙˆØ© Ø§Ù„Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…Ø´ØªØ±ÙƒØ© 
        common_words_count = len(query_words.intersection(key_words))
        
        # 3. Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ø±Ø¬Ø­Ø© (Ù†Ù‚Ø§Ø· Ø§Ù„Ù†ÙŠØ©) - (ØªÙ… Ø²ÙŠØ§Ø¯Ø© Ø§Ù„ÙˆØ²Ù† Ù‡Ù†Ø§ Ù…Ù† 10 Ø¥Ù„Ù‰ 15)
        total_score = ratio_score + (common_words_count * 15) 
        
        if total_score > max_score:
            max_score = total_score
            best_match_answer = answer
    
    # Ø¥Ø°Ø§ ØªØ¬Ø§ÙˆØ²Øª Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù‚ØµÙˆÙ‰ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ØŒ ÙŠØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
    if max_score >= SCORE_THRESHOLD:
        print(f"Intent found with Max Score: {max_score}")
        return best_match_answer
    
    return None # Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø©


# --- 4. Ø¯Ø§Ù„Ø© Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ø¥Ù„Ù‰ ÙÙŠØ³Ø¨ÙˆÙƒ Ù…Ø§Ø³Ù†Ø¬Ø± (ÙƒÙ…Ø§ Ù‡ÙŠ) ---
def send_message(recipient_id, message_text):
    """ØªØ³ØªØ®Ø¯Ù… Access Token Ù„Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…."""
    params = {
        "access_token": PAGE_ACCESS_TOKEN
    }
    headers = {
        "Content-Type": "application/json"
    }
    data = {
        "recipient": {
            "id": recipient_id
        },
        "message": {
            "text": message_text
        }
    }
    # Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ POST Ø¥Ù„Ù‰ API ÙÙŠØ³Ø¨ÙˆÙƒ
    response = requests.post(
        "https://graph.facebook.com/v19.0/me/messages", 
        params=params,
        headers=headers,
        json=data
    )
    # Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù…Ù‡Ù… Ø¬Ø¯Ø§Ù‹ Ù„ØªØ´Ø®ÙŠØµ ÙØ´Ù„ Ø§Ù„Ø±Ø¯!
    if response.status_code != 200:
        print(f"Failed to send message: {response.text}")
        print(f"Status Code: {response.status_code}") 

# --- 5. Ù†Ù‚Ø·Ø© Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙˆÙŠØ¨ (Webhook Endpoint) ---
@app.route('/webhook', methods=['GET', 'POST'])
def webhook():
    # --- ÙƒÙˆØ¯ Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù„ÙÙŠØ³Ø¨ÙˆÙƒ (GET Request) ---
    if request.method == 'GET':
        mode = request.args.get('hub.mode')
        token = request.args.get('hub.verify_token')
        challenge = request.args.get('hub.challenge')
        
        # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø±Ù…Ø²
        if mode == 'subscribe' and token == VERIFY_TOKEN:
            return challenge, 200 
        else:
            return "Verification token mismatch", 403

    # --- ÙƒÙˆØ¯ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ø§Ø¯ÙŠ (POST Request) ---
    if request.method == 'POST':
        data = request.json
        
        # ØªØµÙØ­ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠØ³Ø¨ÙˆÙƒ Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        try:
            for entry in data['entry']:
                for messaging_event in entry['messaging']:
                    if messaging_event.get('message'):
                        sender_id = messaging_event['sender']['id']
                        message_text = messaging_event['message']['text']
                        
                        # Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‚Ø¨Ù„ Ø¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ù„Ù„Ø¨Ø­Ø«
                        cleaned_message = clean_text(message_text) 
                        
                        # Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ØµÙÙˆÙØ© Ø§Ù„Ù†ÙŠØ© Ø§Ù„Ù…Ø±Ø¬Ø­Ø©
                        response_text = get_answer(cleaned_message) 
                        
                        if response_text:
                            # 2. Ø¥Ø¬Ø§Ø¨Ø© Ø¢Ù„ÙŠØ© Ø¬Ø§Ù‡Ø²Ø©
                            send_message(sender_id, response_text)
                        else:
                            # 3. ØªØ­ÙˆÙŠÙ„ Ù„Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¨Ø´Ø±ÙŠ
                            handoff_message = "Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£Ø¬Ø¯ Ø¥Ø¬Ø§Ø¨Ø© Ù…Ø­Ø¯Ø¯Ø©. ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ø¥Ù„Ù‰ ÙØ±ÙŠÙ‚ Ø§Ù„Ø¯Ø¹Ù… Ù„Ø¯ÙŠÙ†Ø§ØŒ ÙˆØ³ÙŠØ±Ø¯ Ø¹Ù„ÙŠÙƒ Ø£Ø­Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†!"
                            send_message(sender_id, handoff_message)
                            # Ø·Ø¨Ø§Ø¹Ø© ÙƒÙ„ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© ÙˆØ§Ù„Ù†Øµ Ø§Ù„Ù†Ø¸ÙŠÙ Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ù„Ø§Ø­Ù‚
                            print(f"*** ØªÙ†Ø¨ÙŠÙ‡: ØªÙ… ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ Ù„Ù„Ù…Ø´Ø±Ù: {message_text} (Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ø¸ÙŠÙ: {cleaned_message}) ***")
        except Exception as e:
            # Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„Ø§Øª Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªØ´Ø®ÙŠØµ
            print(f"Error processing message: {e}")
            
        return jsonify({"status": "ok"}), 200

if __name__ == '__main__':
    app.run(debug=True)
