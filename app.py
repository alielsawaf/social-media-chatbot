from flask import Flask, request
import requests
import os
import google.generativeai as genai

app = Flask(__name__)

# ================== CONFIG (Railway Variables) ==================
# ุงูุชูููุฒ ุฏู ููุชู ูุฑุงุกุชูุง ูู ุฅุนุฏุงุฏุงุช Railway Variables ููุฃูุงู
PAGE_ACCESS_TOKEN = os.environ.get("PAGE_ACCESS_TOKEN")
VERIFY_TOKEN = os.environ.get("VERIFY_TOKEN")
GEMINI_API_KEY = os.environ.get("GEMINI_API_KEY")

# ุฅุนุฏุงุฏ ุงูุฐูุงุก ุงูุงุตุทูุงุนู
genai.configure(api_key=GEMINI_API_KEY)
model = genai.GenerativeModel('gemini-1.5-flash')

# ================== DATA ==================
FAQ_MAP = {
  "ุงูุฑูุฌุฉ ูููุง ุฏูุฏ": "ููุฏู ุฏู ูุด ุฏูุฏุ ุฏู ุจูููู ุทููููุงุช. ุงูุทููููุงุช ูู ุณููุฉ ุงูุฑูุฌุฉ ุชูุฌุฏ ูู ุงูุชุฌููู ุงูุจุทูู ูุฃููุง ุชุฏุฎู ูู ุนูููุงุช ุงูุงูุชุตุงุต ูุงูุชูุซูู ุงูุบุฐุงุฆู ููุณููุฉ ููู ูุง ุชุตูุจ ุงูุฅูุณุงู ุชูุงูุงูุ ูุฒูุงุฏุฉ ูู ุงูููุงูุฉ ูุชู ุชุฌููุฏ ุงูุฃุณูุงู ุนูุฏ ุฏุฑุฌุฉ ูู 35 ุฅูู 40 ุชุญุช ุงูุตูุฑ ูุชุตุจุญ ุงูุทููููุงุช ุฌุฒุก ูู ุงูุฃูุนุงุก ููุง ุชุคุซุฑ ุนูู ุขูููุง. ุงูุฏูุฏ ุงูุญู ูู ููุฌูุฏ ุจูููู ุฎุทุฑ ุนูู ุตุญุฉ ุงูุฅูุณุงู ูุจูููู ุฏููู ุฅู ุงูุณููุฉ ุบูุฑ ุตุงูุญุฉ ููุงุณุชููุงู. ุงูุณูู ุฒู ุงูุฅูุณุงู ููุง ุจูููุช ุจููุฑ ุจูุฑุงุญูุ ูุจู ุธููุฑ ุฏูุฏ ุญู ูุงุฒู ูููู ููุชูุฎ ุซู ูุชุนูู ุซู ูุชูุชูุ ูุทุงููุง ุงูุณููุฉ ุบูุฑ ููุชูุฎุฉ ููุง ูุชุนููุฉ ููุง ูุชูุชูุฉ ูุฏู ุทููููุงุช ุทุจูุนูุฉ ุจูุชุบุฐู ุนูููุง ุงูุณูู.",

  "ูููู": "ุฏู ูููู ูููู ุงูููุชุฌุงุช ุจุชุงุนุชูุง: https://heyzine.com/flip-book/31946f16d5.html",

  "ุงุฒุงู ุงุชุฃูุฏ ุงู ุงูุฑูุฌุฉ ุฏู ุฑูุฌุฉ ุงุจู ุงูุณูุฏ": "ุญุถุฑุชู ุญุงูู ุดุฑุงุก ุฑูุฌุฉ ุฃุจู ุงูุณูุฏ ูู ูุตุงุฏุฑ ููุซููุฉ ูุถูุงู ุญุตููู ุนูู ุงูููุชุฌ ุงูุฃุตูู.",

  "ุงูุฌููุฉ ุงู ุงุณุนุงุฑ ุงูุฌููุฉ": "ููุงุณุชูุณุงุฑ ูุทูุจ ุงููุณุงุนุฏุฉ ูุฑุฌู ุงูุงุชุตุงู ุนูู ุฃุฑูุงู ุงููุตูุน: 01211113882",

  "ุงูุณูุฏูุชุดุงุช": "ูููู ุงูุณุงูุฏููุชุดุงุช ูุงูุณูุทุฉ ุบูุฑ ูุชุงุญ ุญุงููุงู ููุง ููุฌุฏ ุชูุตูู ููุณุงูุฏููุชุดุงุช ูุงูุณูุทุฉ.",

  "ุงูุณูุทุฉ": "ูููู ุงูุณุงูุฏููุชุดุงุช ูุงูุณูุทุฉ ุบูุฑ ูุชุงุญ ุญุงููุงู ููุง ููุฌุฏ ุชูุตูู ููุณุงูุฏููุชุดุงุช ูุงูุณูุทุฉ.",

  "ููุงุนูุฏ ุงููุฑูุน": "ููุงุนูุฏ ุงูุนูู ูู ุงูุณุงุนุฉ 10 ุตุจุงุญุงู ุญุชู ุงูุณุงุนุฉ 12 ููุชุตู ุงูููู.",

  "ุงูุชุตุฏูุฑ": "ุญุถุฑุชู ุชูุงุตู ูุงุชุณุงุจ ูุน ุงูุฃุณุชุงุฐ ุฃุญูุฏ ุนูู ุฑูู 01272475555 ููู ููุณุงุนุฏ ุญุถุฑุชู.",

  "ุฑูู ุงุฏุงุฑุฉ ุงููุดุชุฑูุงุช": "ุฑูู ุฅุฏุงุฑุฉ ุงููุดุชุฑูุงุช: 01223066445",

  "ุงูุชูุธูู": "ุฑูู ุฅุฏุงุฑุฉ ุงูู HR ูู ุจูุฑุณุนูุฏ: 01200056103",

  "ูููู ุงุดูู ุงูุฑูุฌุฉ": "ูุง ููุฌุฏ ุฑูุฌุฉ ููุดูู ููุง ุชุชุนุฑุถ ูุฃู ุญุฑุงุฑุฉุ ุฑูุฌุฉ ุฃุจู ุงูุณูุฏ ุฌุงูุฒุฉ ููุฃูู ูุจุงุดุฑุฉ ููุง ูููู ุฏูููุง ุจุงูุฒูุช.",

  "ุงููุฑู ุจูู ุงูุฑูุฌุฉ ุงููุฌูุฏุฉ ูุงููุฑูุด": "ุงูุฑูุฌุฉ ุงููุฌูุฏุฉ ุชุญูุธ ูู ุฏุฑุฌุฉ ุญุฑุงุฑุฉ -18 ูุตูุงุญูุชูุง 3 ุดููุฑ ููุชู ุญูุธูุง ูู ุงูุชุฌููุฏ. ุงูุฑูุฌุฉ ุงููุฑูุด ุชุญูุธ ูู ุฏุฑุฌุฉ ุญุฑุงุฑุฉ ูู 0 ุฅูู 4 ูุตูุงุญูุชูุง ุดูุฑ ููุชู ุญูุธูุง ูู ุงูุชุจุฑูุฏ.",

  "ูุฒู ูุฑุชููุฉ ุงูุฑูุฌุฉ ุงููุฌูุฏุฉ": "ูุฒู ูุฑุชููุฉ ุงูุฑูุฌุฉ ุงููุฌูุฏุฉ ุจูููู ูู 7.5 ุฅูู 8 ูููู ูุง ููุฏู.",

  "ุงููุฑู ุจูู ุงูููุณ ุงูุงุณูุฏ ูุงูุฌููุฏ ูุงูููู ูู ุงููุณูุฎ": "ุงูุฃุญุฌุงู ุงูุตุบูุฑุฉ ุจุชููู ูู ุงูุชุบููู ุงูุฌููุฏ ูุงูููู ุจุญุฏ ุฃูุตู 600 ุฌุฑุงูุ ูุงูุฃุญุฌุงู ุงูุฃูุจุฑ ุจุชููู ูู ุงูุชุบููู ุงูุฃุณูุฏ ููููู ุชูุตู ููููู ุฃู ูููู ู200 ุฃู 800 ุฌุฑุงู.",

  "ุงููุฑู ุจูู ุงูุฑูุฌุฉ ุงูุนุงุฏูุฉ ูุนูุงุฑ 24": "ุนูุงุฑ 24 ุนุฏุฏ ุณุงุนุงุช ุงูุชุฏุฎูู ููู ุฃุทููุ ุญุฌู ุงูุณููุฉ ุฃุตุบุฑุ ูุทุนู ุงูุชุฏุฎูู ูุนุฒุฒ ุฃูุซุฑ ุจุณุจุจ ุฒูุงุฏุฉ ุณุงุนุงุช ุงูุชุฏุฎูู.",

  "ููููุฉ ุงูุงุญุชูุงุธ ุจุงูุฑูุฌุฉ ุจุนุฏ ุงูุดุฑุงุก": "ููุถู ุญูุธ ุงูุฑูุฌุฉ ูู ุงููุฑูุฒุฑ ุจุนุฏ ุงูุดุฑุงุก.",

  "ูุนูู ุงูู ุฑูุฌุฉ ูุงูููู": "ุฑูุฌุฉ ูุบููุฉ ูู ุนุจูุงุช ููุฑุบุฉ ุงูููุงุก.",

  "ุงููุณูุฎ ุจูุชููุญ ุงุฒุงู": "ุงููุณูุฎ ูุชู ุชุตููุนู ูู ุณูู ุงูุจูุฑูุ ูุชู ุชูููุญู ูุฑูุด ูููู ุงูููู ุงูุจูุชูุฑูุ ุชูููุญ ุฌุงูุ ููุญูุธ ูู ุซูุงุฌุงุช ุจุฏุฑุฌุงุช ุญุฑุงุฑุฉ ูู 0 ุฅูู 4.",

  "ุงููุฑู ุจูู ูุญู ุงูุชููุฉ ุงูุงุจูุถ ูุงูุงุญูุฑ": "ุงููุญู ุงูุฃุจูุถ ุฃูุชุญ ูู ุงูุฃุญูุฑ ูุฃู ุงูููู ุงูุฃุญูุฑ ูุงุชุฌ ุนู ุงููููุฌููุจูู ูุงูููููุฌููุจููุ ูุงููุญู ุงูุฃุญูุฑ ูุญุชูู ุนูู ูุณุจุฉ ุจุฑูุชูู ุฃุนูู ููููู ุทุฑู ุฃูุซุฑ.",

  "ููู ุงููุณูุฎ ุจูููู ูู ุฏู": "ุงูุณููุฉ ุฌุงูุฒุฉ ููุฃููุ ูุงูุฏู ุจูููู ูุชูุฌุฉ ุงูุชูููุญ ุงููุฑูุด ูุงูุชุฌููุฏุ ูุนูุฏ ูู ุงูุชุฌููุฏ ุจุชุธูุฑ ุงูุณูุงุฆู.",

  "ููู ุงูุฑูุฌุฉ ุงูููููู ูุงุดูุฉ": "ุงูุฑูุฌุฉ ุงูููููู ุจุชููู ูุฎููุฉ ูุจุชุงุฎุฏ 3 ุทุจูุงุช ุชุฏุฎูู ูุชุนุฒูุฒ ุงูุทุนู ูุฏู ุจูุฎูููุง ุฃูุดู ุดููุฉ.",

  "ุงููุฑู ุจูู ุงูุฑูุฌุฉ ุงูููููู ูุงูุนุงุฏูุฉ": "ุงูููููู ูุฎููุฉ ูุชูุฑ ุจูุฑุงุญู ุชูููุญ ูุชุฏุฎูู ููุซู ู3 ุทุจูุงุช ุณูููุ ูุจุชููู ุฃูุดู ูุทุนููุง ูุฎุชูู.",

  "ูุฏูุฑ ุงูุญุณุงุจุงุช": "ุงูุฃุณุชุงุฐ ูุญูุฏ ุงูุดูุงุน ูุฏูุฑ ุงูุญุณุงุจุงุชุ ุฑูู ุงูุชูุงุตู: 01204464066",

  "ุชูุฑูุฏ ููููุงุฏู ูุงููุทุงุนู": "ุงูุฃุณุชุงุฐ ุจูุงู ูุณุคูู ุงูุชูุฑูุฏุ ุฑูู ุงูุชูุงุตู: 01221093951",

  "ุงููุฑู ุจูู ุงูุณูููู ุงููุงูููู ูุงูููุณ ุงูุงุณูุฏ": "ุงูุงุฎุชูุงู ูู ููู ุงููุญู ุจุณุจุจ ุทุฑููุฉ ุงูุชุฏุฎูู ูุงูุชูููุญ ูุงูุทูู ูุฏู ุจูุฃุซุฑ ุนูู ุงูุทุนู.",

  "ุงูุชููุฉ ูุณุชูุฑุฏุฉ ููุง ูุตุฑู": "ุงููุงูุฒ ูุณุชูุฑุฏ ููู ุงูุชููุฉ ููุณูุง ูุตุฑูุฉ ููุชู ุตูุฏูุง ูู ุงูุจุญุฑ ุงูุฃุจูุถ ุงููุชูุณุท.",

  "ููู ุงูููุชุฌุงุช ุบุงููุฉ": "ูุฃููุง ุจูุถูู ุฌูุฏุฉ ุนุงููุฉ ูุทุฑููุฉ ุชูููุญ ูุชุฏุฎูู ูุฎุชููุฉ.",

  "ูุนูู ุงูู ูุงูููู": "ูุบูู ูู ุนุจูุงุช ููุฑุบุฉ ุงูููุงุก.",

  "ููุน ุงูุชููุฉ": "ุชููุฉ ูููููู.",

  "ุจุชุตุทุงุฏูุง ุงูุชููุฉ ูููู": "ูู ูุตุฑ ูู ุงูุจุญุฑ ุงูุฃุจูุถ ุงููุชูุณุท.",

  "ุงูุชููุฉ ุฒูุช ููุง ููุงู": "ูู ุงูุชููุฉ ูุนุจุฃุฉ ูู ุฒูุช ูุจุงุชู ููุท.",

  "ูู ูู ููุงุฏ ุญุงูุธุฉ": "ูู ููุชุฌุงุชูุง ุจุฏูู ููุงุฏ ุญุงูุธุฉ.",

  "ูู ูููู ุงุณุฎู ุงูุฑูุฌุฉ": "ุฑูุฌุฉ ุฃุจู ุงูุณูุฏ ูุง ูููู ุชุณุฎูููุง ุฃู ุทูููุงุ ูู ุฌุงูุฒุฉ ููุฃูู.",

  "ุชูุงุจู ุงููุงูุฑูู ุงูููููู": "ูููู ุฃุณูุฏ ููููู ุฃุจูุถ.",

  "ุจุทุงุฑุฎ ุงูุจูุฑู ุจุงูุฒุจุฏุฉ": "ุจุชููู ุจุทุงุฑุฎ ุจูุถุงุก ูุดู.",

  "ุงููุงุน ุจุทุงุฑุฎ ุงูุฑูุฌุฉ": "ููุน ูุฑููุฉ ููุฑูุณุฉ ูููุน ูุฑููุฉ ูุงููุฉ.",

  "ูู ุงูุชููุฉ ุงููุทููุฉ ุฌุงูุฒุฉ ููุงูู": "ุงูุชููุฉ ุงููุทููุฉ ุฌุงูุฒุฉ ููุฃูู ุจุฏูู ุฒูุช ุฃู ููุงู ููุญููุธุฉ ูุงูููู ูุจุฃูุฒุงู ูุฎุชููุฉ.",

  "ูู ูู ุณูู ูุฌูุฏ ุจุฏูู ุชุตููุน": "ูุง ููุฌุฏ ุณูู ูุฌูุฏ ุจุฏูู ุชุตููุน ูู ุงููุตูุน.",

  "ููุน ุงูุณูููู ููุทูู": "ุงูุณูููู ุงูููููู ุงููู."
}

PRODUCT_MAP = {
  "Smoked Herring with Roe": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ูุฏุฎูุฉ ูุจุทุฑุฎุฉ ูุฑููุฉ:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 250 EGP โจ",

  "Smoked Herring": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ูุฏุฎูุฉ:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 200 EGP โจ",

  "Smoked Herring 24 Kerat": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ูุฏุฎูุฉ 24 ููุฑุงุท:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 300 EGP โจ",

  "Smoked Herring 24 Kerat with Roe": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ูุฏุฎูุฉ ูุจุทุฑุฎุฉ ูุฑููุฉ 24 ููุฑุงุท:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 320 EGP โจ",

  "Gutted Smoked Vacuumed Herring": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ูุฏุฎูุฉ ููุฒูุนุฉ ุงูุฃุญุดุงุก ูุงูููู:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 300 EGP โจ",

  "Smoked Vacuumed Herring with Roe": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ูุจุทุฑุฎุฉ ูุฑููุฉ ูุงูููู:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 300 EGP โจ",

  "Smoked Herring in Vacuum Packing": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ูุฏุฎูุฉ ูุงูููู:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 275 EGP โจ",

  "Herring Fillets without Oil": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ููููู ุจุฏูู ุฒูุช:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 600 EGP โจ",

  "Herring Fillets with Pepper Sauce and Caviar": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ููููู ุจุตูุต ุงููููู ูุงููุงููุงุฑ:\nุงููุฒู: 200 G\nุงูุณุนุฑ: 150 EGP โจ",

  "Herring Fillets with Sweet Sauce": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ููููู ุจุตูุต ุงูุณูุฑ:\nุงููุฒู: 230 G\nุงูุณุนุฑ: 180 EGP โจ",

  "Herring Fillets with Curry Sauce": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ููููู ุจุตูุต ุงููุงุฑู:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Herring Fillets with Pepper Sauce": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ููููู ุจุตูุต ุงููููู:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Herring Fillets with Vegetable Oil": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ููููู ุจุงูุฒูุช ุงููุจุงุชู:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Smoked Herring Fillets": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ููููู ูุฏุฎูุฉ:\nุงููุฒู: 125 G\nุงูุณุนุฑ: 85 EGP โจ",

  "Herring with Caviar Spread 200": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ูุน ูุงููุงุฑ ุณุจุฑูุฏ:\nุงููุฒู: 200 G\nุงูุณุนุฑ: 70 EGP โจ",

  "Herring with Caviar Spread 130": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ูุน ูุงููุงุฑ ุณุจุฑูุฏ:\nุงููุฒู: 130 G\nุงูุณุนุฑ: 70 EGP โจ",

  "Herring with Caviar Spread Tube": "๐ฐ ุณุนุฑ ุฑูุฌุฉ ูุน ูุงููุงุฑ ุณุจุฑูุฏ ุชููุจ:\nุงููุฒู: 100 G\nุงูุณุนุฑ: 70 EGP โจ",

  "Herring Roe with Vegetable Oil": "๐ฐ ุณุนุฑ ุจุทุงุฑุฎ ุฑูุฌุฉ ุจุงูุฒูุช ุงููุจุงุชู ูุฑููุฉ ูุงููุฉ:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Herring Roe with Orange Sauce": "๐ฐ ุณุนุฑ ุจุทุงุฑุฎ ุฑูุฌุฉ ุจุตูุต ุงูุจุฑุชูุงู ูุฑููุฉ ููุฑูุณุฉ:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Herring Roe with Honey Sauce": "๐ฐ ุณุนุฑ ุจุทุงุฑุฎ ุฑูุฌุฉ ุจุตูุต ุงูุนุณู ูุฑููุฉ ููุฑูุณุฉ:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Herring Roe White": "๐ฐ ุณุนุฑ ูุดู ุจุทุงุฑุฎ ุฑูุฌุฉ ุจุงูุฒูุช ุงููุจุงุชู:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Gutted Smoked Mackerel Salted": "๐ฐ ุณุนุฑ ูุงูุฑูู ูุฏุฎู ูููุญ ููุฒูุน ุงูุฃุญุดุงุก:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 410 EGP โจ",

  "Smoked Salted Mackerel Vacuumed": "๐ฐ ุณุนุฑ ูุงูุฑูู ูุฏุฎู ูููุญ ููุฒูุน ุงูุฃุญุดุงุก ูุงูููู:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 460 EGP โจ",

  "Mackerel Fillets with Spices Vacuumed": "๐ฐ ุณุนุฑ ูุงูุฑูู ููููู ุจุงูุชูุงุจู ูุงูููู:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 800 EGP โจ",

  "Mackerel Fillets Vacuumed": "๐ฐ ุณุนุฑ ูุงูุฑูู ููููู ุณุงุฏุฉ ูุงูููู:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 800 EGP โจ",

  "Salted Grey Mullet with Vegetable Oil": "๐ฐ ุณุนุฑ ููููู ุจูุฑู ูููุญ ุฒูุช ูุจุงุชู:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Salted Grey Mullet with Smoked Oil": "๐ฐ ุณุนุฑ ููููู ุจูุฑู ูููุญ ุฒูุช ุฏุฎุงู:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Salted Grey Mullet with Beet Sauce": "๐ฐ ุณุนุฑ ูุณูุฎ ุณุจุฑูุฏ ุจุตูุต ุงูุจูุฌุฑ:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Salted Grey Mullet with Curry Sauce": "๐ฐ ุณุนุฑ ูุณูุฎ ุณุจุฑูุฏ ุจุตูุต ุงููุงุฑู:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Salted Grey Mullet with Pepper Sauce": "๐ฐ ุณุนุฑ ูุณูุฎ ุณุจุฑูุฏ ุจุตูุต ุงููููู:\nุงููุฒู: 250 G\nุงูุณุนุฑ: 250 EGP โจ",

  "Smoked Salted Mullet": "๐ฐ ุณุนุฑ ุจูุฑู ูููุญ ูุฏุฎู ูุณูุฎ:\nุงููุฒู: 230 G\nุงูุณุนุฑ: 150 EGP โจ",

  "Salted Mullet without Bacteria": "๐ฐ ุณุนุฑ ูุณูุฎ ุจุฏูู ุจูุชูุฑูุง:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 460 EGP โจ",

  "Salted Mullet with Roe": "๐ฐ ุณุนุฑ ูุณูุฎ ูุจุทุฑุฎ ุจุฏูู ุจูุชูุฑูุง:\nุงููุฒู: 1 KG\nุงูุณุนุฑ: 560 EGP โจ"
}

# ุชุนูููุงุช ุงูู AI (ุงูุจุฑููุจุช)
SYSTEM_INSTRUCTION = f"""
ุฃูุช ูุณุงุนุฏ ุฎุฏูุฉ ุนููุงุก ุฐูู ููุตูุน "ุฑูุฌุฉ ุฃุจู ุงูุณูุฏ". 
ูููุชู ุงูุฑุฏ ุนูู ุงุณุชูุณุงุฑุงุช ุงูุฒุจุงุฆู ุจููุฌุฉ ูุตุฑูุฉ ูุฏูุฏุฉ ุฌุฏุงู ูุงุณุชุฎุฏู ูููุฉ ูุงููุฏู ุฏุงุฆูุง ูู ูู ุงูุฑุฏูุฏ ูููููุน ุงูุชุนุตุจ ุงู ุงูุงุณุชูุชุงุฑ ููุงุฆู ุจููุงู ุงูุนููู ูุจุฃุณููุจ "ุงุญุชุฑุงูู".
ุงุณุชุฎุฏู ุงููุนูููุงุช ุงูุชุงููุฉ ููุท ููุฑุฏ:
1. ุงูุฃุณุฆูุฉ ุงูุดุงุฆุนุฉ: {str(FAQ_MAP)}
2. ูุงุฆูุฉ ุงูุฃุณุนุงุฑ: {str(PRODUCT_MAP)}

ููุงุนุฏ ูุงูุฉ:
- ุฅุฐุง ุณุฃู ุงูุนููู ุนู ุณุนุฑุ ุงุจุญุซ ุนูู ูู ุงููุงุฆูุฉ ูุฃุนุทู ุงูุณุนุฑ ูุงููุฒู.
- ุฅุฐุง ูู ุชุฌุฏ ุงูุฅุฌุงุจุฉ ูู ุงููุนูููุงุชุ ุงุทูุจ ููู ุจุฐูุงุก ุงูุชูุงุตู ูุน ุงูุฅุฏุงุฑุฉ ุนูู 01211113882.
- ุงุณุชุฎุฏู ุงูุฅูููุฌู ุงูููุงุณุจ (๐, ๐ฐ, โจ).
- ูุง ุชุฎุชุฑุน ุฃุณุนุงุฑุงู ูู ุนูุฏู ุฃุจุฏุงู.
"""

# ================== LOGIC ==================
def normalize(text):
    return text.lower().replace("ุฉ", "ู").replace("ุฃ", "ุง").replace("ุฅ", "ุง").replace("ุข", "ุง").strip()

def get_ai_answer(user_text):
    try:
        prompt = f"{SYSTEM_INSTRUCTION}\nุงูุนููู ูููู: {user_text}\nุงูุฑุฏ ุงููุณุงุนุฏ:"
        response = model.generate_content(prompt)
        return response.text
    except:
        return "ูููุฑูุง ูู ุฑูุฌุฉ ุฃุจู ุงูุณูุฏ! ูููู ุชูุถุญ ุณุคุงูู ุฃูุชุฑ ุนุดุงู ุฃูุฏุฑ ุฃุณุงุนุฏูุ"

def get_answer(text):
    q = normalize(text)
    
    # 1. ูุญุต ูุฏูู ุณุฑูุน (ุงูุฃุณุฆูุฉ ุงููู ุฅูุช ุนุงุฑููุง ููููุฉ)
    if "ุฏู" in q:
        return FAQ_MAP.get("ููู ุงููุณูุฎ ุจูููู ูู ุฏู", "ุงูุณููุฉ ุฌุงูุฒุฉ ููุฃููุ ูุงูุฏู ุจูููู ูุชูุฌุฉ ุงูุชูููุญ ุงููุฑูุด ูุงูุชุฌููุฏ.")
    
    if "ุณุนุฑ" in q or "ุจูุงู" in q:
        if "ูุณูุฎ" in q:
            return f"ุฃุณุนุงุฑ ุงููุณูุฎ ุนูุฏูุง:\n- {PRODUCT_MAP.get('Salted Mullet without Bacteria')}\n- {PRODUCT_MAP.get('Salted Mullet with Roe')}"
        if "ุฑูุฌ" in q:
            return f"ุฃุณุนุงุฑ ุงูุฑูุฌุฉ:\n- {PRODUCT_MAP.get('Smoked Herring')}\n- {PRODUCT_MAP.get('Smoked Herring 24 Kerat')}"

    # 2. ูู ูููุงุด ุฑุฏ ูุฏููุ ูุฑูุญ ููู AI
def get_ai_answer(user_text):
    try:
        prompt = f"{SYSTEM_INSTRUCTION}\nุงูุนููู ุจูููู: {user_text}\nุงูุฑุฏ:"
        response = model.generate_content(prompt)
        return response.text
    except Exception as e:
        # ุงูุณุทุฑ ุฏู ููุฎูู ุงูุฎุทุฃ ูุธูุฑูู ูู Railway Logs ุจุงูุธุจุท
        print(f"ูุดู ุงูู AI ุจุณุจุจ: {e}") 
        return "ูููุฑูุง ูู ุฑูุฌุฉ ุฃุจู ุงูุณูุฏ! ูููู ุชูุถุญ ุณุคุงูู ุฃูุชุฑ ุนุดุงู ุฃูุฏุฑ ุฃุณุงุนุฏูุ"



#  ------------------------
 #   ai_reply = get_ai_answer(text)
    
    # ูู ุงูู AI ูุดู ูุฑุฌุน ุงูุฑุฏ ุงูุซุงุจุชุ ูุญุงูู ูุจุนุชูู ุฑุฏ ุจุฏูู ุฐูู
  #  if "ูููู ุชูุถุญ ุณุคุงูู ุฃูุชุฑ" in ai_reply:
   #      return "ูุง ููุฏู ููุฑุชูุง! ุชุญุจ ุชุนุฑู ุฃุณุนุงุฑ ุงูุฑูุฌุฉ ููุง ุงููุณูุฎ ููุง ุฃูุงูู ุงููุฑูุนุ"
         
    #return ai_reply

# ================== WEBHOOK ==================
@app.route("/webhook", methods=["GET"])
def verify():
    if request.args.get("hub.verify_token") == VERIFY_TOKEN:
        return request.args.get("hub.challenge")
    return "failed", 403

@app.route("/webhook", methods=["POST"])
def webhook():
    data = request.get_json()
    if data.get("object") == "page":
        for entry in data.get("entry", []):
            for ev in entry.get("messaging", []):
                sender = ev["sender"]["id"]
                if "message" in ev and "text" in ev["message"]:
                    msg_text = ev["message"]["text"]
                    reply = get_answer(msg_text)
                    send_message(sender, reply)
    return "ok", 200

def send_message(user_id, text):
    url = f"https://graph.facebook.com/v12.0/me/messages?access_token={PAGE_ACCESS_TOKEN}"
    payload = {"recipient": {"id": user_id}, "message": {"text": text}}
    requests.post(url, json=payload)

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=int(os.environ.get("PORT", 8080)))


